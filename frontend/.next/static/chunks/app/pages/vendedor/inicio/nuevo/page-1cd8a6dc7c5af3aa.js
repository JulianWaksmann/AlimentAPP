(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[381],{6138:(e,t,a)=>{Promise.resolve().then(a.bind(a,6946))},6946:(e,t,a)=>{"use strict";a.d(t,{default:()=>s});var o=a(5155),r=a(2115);async function n(){let e=await fetch("".concat("https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd","/productos"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching productos");return(await e.json()).productos}async function d(){let e=await fetch("".concat("https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd","/all-clients"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching productos");return(await e.json()).clients}var i=a(8569);let s=()=>{let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)([]),[c,l]=(0,r.useState)(""),[u,m]=(0,r.useState)(""),[h,p]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{s(await d())})()},[]),(0,r.useEffect)(()=>{(async()=>{t(await n())})()},[]);let[x,f]=(0,r.useState)({id:"",cantidad:""}),g=()=>{l(""),m(""),p([]),f({id:"",cantidad:""})},j=async()=>{if(!c||!u||0===h.length)return void alert("Completa todos los campos antes de guardar.");let e={id_cliente:Number(c),id_vendedor:1,productos:h.map(e=>({id_producto:e.id,cantidad:e.cantidad})),fecha_entrega_solicitada:u};try{await (0,i.lm)(e),alert("Pedido creado con \xe9xito."),g()}catch(e){console.error("Error al crear el pedido:",e),alert("Hubo un error al crear el pedido. Por favor, intenta nuevamente.")}console.log("Pedido a guardar:",e),alert("Pedido guardado con exito (revisa la consola)."),g()};return(0,o.jsxs)("div",{className:"mx-auto max-w-4xl rounded-lg bg-white p-4 shadow-lg md:p-6",children:[(0,o.jsx)("h2",{className:"mb-6 text-center text-xl font-bold text-primary",children:"Formulario de Nuevo Pedido"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"cliente",className:"mb-1 block text-sm font-medium",children:"Cliente"}),(0,o.jsxs)("select",{id:"cliente",value:c,onChange:e=>l(e.target.value),className:"w-full rounded border px-3 py-2",children:[(0,o.jsx)("option",{value:"",disabled:!0,children:"Selecciona un cliente"}),a.map(e=>(0,o.jsx)("option",{value:e.id,children:e.nombre_contacto+" "+e.apellido_contacto},e.id))]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"fechaEntrega",className:"mb-1 block text-sm font-medium",children:"Fecha de entrega"}),(0,o.jsx)("input",{id:"fechaEntrega",type:"date",value:u,onChange:e=>m(e.target.value),className:"w-full rounded border px-3 py-2"})]})]}),(0,o.jsxs)("div",{className:"mt-6 rounded border border-details p-4",children:[(0,o.jsx)("h3",{className:"mb-3 text-lg font-semibold",children:"Agregar Productos"}),(0,o.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-end",children:[(0,o.jsxs)("div",{className:"flex-grow",children:[(0,o.jsx)("label",{htmlFor:"producto",className:"mb-1 block text-sm font-medium",children:"Producto"}),(0,o.jsxs)("select",{id:"producto",value:x.id,onChange:e=>f({...x,id:e.target.value}),className:"w-full rounded border px-3 py-2",children:[(0,o.jsx)("option",{value:"",disabled:!0,children:"Selecciona un producto"}),e.map(e=>(0,o.jsx)("option",{value:e.id,children:e.nombre},e.id))]})]}),(0,o.jsxs)("div",{className:"w-full md:w-32",children:[(0,o.jsx)("label",{htmlFor:"cantidad",className:"mb-1 block text-sm font-medium",children:"Cantidad"}),(0,o.jsx)("input",{id:"cantidad",type:"number",min:"1",placeholder:"Cant.",value:x.cantidad,onChange:e=>f({...x,cantidad:e.target.value}),className:"w-full rounded border px-3 py-2"})]}),(0,o.jsx)("button",{onClick:()=>{let t=e.find(e=>e.id===Number(x.id)),a=Number(x.cantidad);return t&&a&&!(a<=0)?h.some(e=>e.id===t.id)?void alert("El producto ya ha sido agregado. Puedes editarlo o eliminarlo."):void(p([...h,{id:t.id,nombre:t.nombre,cantidad:a}]),f({id:"",cantidad:""})):void alert("Por favor, selecciona un producto y una cantidad valida.")},className:"rounded bg-primary px-4 py-2 text-white transition hover:opacity-90",children:"+ Agregar"})]})]}),h.length>0&&(0,o.jsxs)("div",{className:"mt-6",children:[(0,o.jsx)("h3",{className:"mb-2 text-lg font-semibold",children:"Productos en el Pedido"}),(0,o.jsx)("ul",{className:"space-y-2",children:h.map(e=>(0,o.jsxs)("li",{className:"flex items-center justify-between rounded bg-neutral-light p-2",children:[(0,o.jsxs)("span",{children:[e.nombre," - ",(0,o.jsxs)("strong",{children:["Cantidad: ",e.cantidad]})]}),(0,o.jsx)("button",{onClick:()=>{var t;return t=e.id,void p(h.filter(e=>e.id!==t))},className:"text-sm text-red-600 hover:text-red-800",children:"Eliminar"})]},e.id))})]}),(0,o.jsxs)("div",{className:"mt-8 flex justify-end gap-3",children:[(0,o.jsx)("button",{onClick:g,className:"rounded bg-neutral-dark px-6 py-2 text-white transition hover:opacity-90",children:"Cancelar"}),(0,o.jsx)("button",{onClick:j,className:"rounded bg-success px-6 py-2 text-white transition hover:opacity-90",children:"Guardar"})]})]})}},8569:(e,t,a)=>{"use strict";a.d(t,{NV:()=>d,OV:()=>i,X6:()=>r,lm:()=>n});let o="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function r(){let e=await fetch("".concat(o,"/crear-orden-venta"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching productos");return(await e.json()).data}async function n(e){console.log("Creando nuevo pedido con data:",e);let t=await fetch("".concat(o,"/crear-orden-venta"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log(JSON.stringify(e)),!t.ok){let e=await t.json();throw Error("Error creating pedido: ".concat(t.status," - ").concat(JSON.stringify(e)))}return t.json()}async function d(){let e=await fetch("".concat(o,"/get-orden-venta"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching solicitudes de venta");return(await e.json()).orden_ventas_pendientes}async function i(e,t){let a=await fetch("".concat(o,"/crear-orden-venta/update-estado-orden-venta"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_pedido:e,estado:t})});if(!a.ok){let e=await a.json();throw Error("Error updating estado: ".concat(a.status," - ").concat(JSON.stringify(e)))}return a.json()}}},e=>{e.O(0,[441,255,358],()=>e(e.s=6138)),_N_E=e.O()}]);