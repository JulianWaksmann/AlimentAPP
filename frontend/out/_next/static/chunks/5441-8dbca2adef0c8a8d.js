"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5441],{11930:(e,a,t)=>{t.d(a,{A:()=>o});var r=t(95155),n=t(12115),s=t(96440);let i=e=>e?new Date(e).toLocaleString():"—";function o(e){let{tandas:a,className:t,estado:o}=e,[c,l]=(0,n.useState)({}),[u,m]=(0,n.useState)({}),[p,h]=(0,n.useState)({}),[x,g]=(0,n.useState)(a||[]),[_,f]=(0,n.useState)(!1),[j,y]=(0,n.useState)(""),[v,N]=(0,n.useState)(""),[b,w]=(0,n.useState)(null),[k,C]=(0,n.useState)("en_progreso"),E=new Date;(0,n.useEffect)(()=>{g(a||[])},[a]);let S=(e,a)=>{N(e),y(a),f(!0)},O=(0,n.useCallback)(async()=>{try{let e=await (0,s.Ec)(o);g(e)}catch(e){console.error("Error fetching tandas:",e)}},[o]);(0,n.useEffect)(()=>{O()},[O]);let T=async()=>{var e,a;if(null===b)return;let t=Array.from(new Set((null!=(a=null==(e=x.find(e=>e.id_linea_produccion===b))?void 0:e.tandas_de_produccion)?a:[]).map(e=>e.id_tanda_produccion).filter(e=>"number"==typeof e&&!isNaN(e))));if(0===t.length)return void S("Error","No se encontraron ids de tanda v\xe1lidos.");h(e=>({...e,[b]:!0}));try{await (0,s.w_)(t,k),g(e=>e.map(e=>{var a;if(e.id_linea_produccion!==b)return e;let r=(null!=(a=e.tandas_de_produccion)?a:[]).map(e=>t.includes(e.id_tanda_produccion)?{...e,estado_tanda_produccion:k}:e);return{...e,tandas_de_produccion:r}})),S("\xc9xito","Tandas actualizadas correctamente.")}catch(e){console.error(e),S("Error","Error al actualizar las tandas. Reintenta.")}finally{h(e=>({...e,[b]:!1})),w(null)}};return x&&0!==x.length?(0,r.jsxs)("div",{className:"space-y-4 p-4 ".concat(null!=t?t:""),children:[x.map((e,a)=>{var t,n,s;let o=null!=(n=e.id_linea_produccion)?n:a,d=null!=(s=e.tandas_de_produccion)?s:[];return(0,r.jsxs)("article",{className:"bg-white shadow-sm rounded-lg overflow-hidden border border-gray-200",children:[(0,r.jsxs)("header",{className:"flex items-center justify-between p-3 sm:p-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-base font-semibold text-gray-800",children:["L\xednea de Producci\xf3n #",o," "]}),e.nombre_linea_produccion?(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:["\xb7 ",e.nombre_linea_produccion]}):null,d.map(e=>{var a,t,n;return(0,r.jsx)("div",{className:"text-sm text-gray-500",children:(0,r.jsxs)("div",{children:["Orden #",e.id_orden_produccion," - ",null!=(t=e.nombre_producto)?t:"Producto #".concat(null!=(a=e.id_producto)?a:"—")," \xb7 ",null!=(n=e.cantidad_kg_tanda)?n:"—"," kg"]})},e.id_orden_produccion)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>l(e=>({...e,[o]:!e[o]})),"aria-expanded":!!c[o],className:"text-sm px-3 py-1 rounded-md bg-primary/10 text-primary hover:bg-primary/20",children:c[o]?"Ocultar":"Ver"}),(0,r.jsx)("button",{onClick:()=>((e,a)=>{var t;let r=null==(t=a[0])?void 0:t.estado_tanda_produccion,n="\xbfSeguro que quer\xe9s ".concat(("planificada"===r?"Poner en producci\xf3n":"Finalizar Tanda").toLowerCase()," todas las \xf3rdenes de esta l\xednea?");w(e),C("planificada"===r?"en_progreso":"completada"),S("Confirmaci\xf3n",n)})(o,d),disabled:!!p[o],className:"text-sm px-3 py-1 rounded-md bg-amber-600 text-white hover:opacity-90 disabled:opacity-50",children:p[o]?"Enviando...":(null==(t=d[0])?void 0:t.estado_tanda_produccion)==="planificada"?"Poner en producci\xf3n":"Finalizar Tanda"})]})]}),c[o]&&(0,r.jsxs)("div",{className:"divide-y",children:[d.map(e=>{var a,t,n,s,o,d,c,l,p,h,x,g,_;let f=null!=(t=e.id_orden_produccion)?t:Math.random();return(0,r.jsxs)("div",{className:"p-3 sm:p-4",children:[(0,r.jsx)("div",{className:"flex items-start justify-between gap-3",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-800",children:null!=(s=e.nombre_producto)?s:"Producto #".concat(null!=(n=e.id_producto)?n:"—")}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Cliente: ",null!=(o=e.nombre_cliente)?o:"—"," ",null!=(d=e.apellido_cliente)?d:""]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("p",{className:"text-sm font-medium text-gray-700",children:[null!=(c=e.cantidad_kg_tanda)?c:"—"," kg"]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500",children:["Sec: ",null!=(l=e.secuencia_en_linea)?l:"—"]})]})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[(0,r.jsxs)("div",{children:["Fecha creaci\xf3n de orden de producci\xf3n: ",i(e.fecha_creacion_orden_produccion)]}),(0,r.jsxs)("div",{children:["Fecha de entrega solicitada: ",i(e.fecha_entrega_solicitada_orden_venta)]}),(0,r.jsxs)("div",{className:"mt-1",children:["Estado tanda:"," ",(0,r.jsx)("span",{className:"font-medium ".concat(E>new Date(null!=(p=e.fecha_entrega_solicitada_orden_venta)?p:"")?"text-red-600":"text-green-600"),children:E>new Date(null!=(h=e.fecha_entrega_solicitada_orden_venta)?h:"")?"Retrasada":"A tiempo"})]})]})]})}),(0,r.jsx)("div",{className:"mt-3 flex items-center gap-2",children:(0,r.jsx)("button",{onClick:()=>m(e=>({...e,[f]:!e[f]})),className:"text-sm px-3 py-1 rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200",children:u[f]?"Ocultar detalle":"Ver detalle"})}),u[f]&&(0,r.jsxs)("div",{className:"mt-3 bg-gray-50 p-3 rounded-md text-sm text-gray-700",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Id Orden:"})," ",e.id_orden_produccion]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Cantidad producto:"})," ",null!=(x=e.cantidad_producto)?x:"—"," bultos"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Fecha entrega solicitada:"})," ",i(e.fecha_entrega_solicitada_orden_venta)]})]}),(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsxs)("details",{className:"bg-white border rounded-md",children:[(0,r.jsxs)("summary",{className:"px-3 py-2 cursor-pointer flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-sm font-medium",children:"Materias primas requeridas"}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:[null!=(g=null==(a=e.materias_primas_requeridas)?void 0:a.length)?g:0," items"]})]}),(0,r.jsxs)("div",{className:"p-3 space-y-2",children:[(null!=(_=e.materias_primas_requeridas)?_:[]).map(e=>{var a,t;return(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.nombre_materia_prima}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.codigo_lote})]}),(0,r.jsxs)("div",{className:"text-right text-sm text-gray-700",children:[e.cantidad_materia_prima," ",null!=(a=e.unidad_medida_materia_prima)?a:""]})]},null!=(t=e.id_lote_materia_prima)?t:e.codigo_lote)}),(!e.materias_primas_requeridas||0===e.materias_primas_requeridas.length)&&(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"No hay materias primas asignadas"})]})]})})]})]},f)}),0===d.length&&(0,r.jsx)("div",{className:"p-4 text-center text-sm text-gray-500",children:"No hay \xf3rdenes en esta tanda"})]})]},o)}),(0,r.jsxs)(d,{visible:_,onClose:()=>f(!1),title:v,children:[(0,r.jsx)("p",{children:j}),(0,r.jsx)("button",{onClick:T,className:"mt-4 px-4 py-2 bg-green-600 text-white rounded",children:"Confirmar"})]})]}):(0,r.jsx)("div",{className:"p-4 text-center text-sm text-gray-500",children:"No hay tandas para mostrar"})}let d=e=>{let{visible:a,onClose:t,title:n,children:s}=e;return a?(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:n}),(0,r.jsx)("div",{children:s}),(0,r.jsx)("button",{onClick:t,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded",children:"Cerrar"})]})}):null}},20063:(e,a,t)=>{var r=t(47260);t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}})},51730:(e,a,t)=>{t.d(a,{default:()=>i});var r=t(95155);t(12115);var n=t(20063),s=t(84926);let i=()=>{let e=(0,n.useRouter)();return(0,r.jsxs)("header",{className:"bg-gradient-primary text-white py-3 text-center relative flex items-center justify-center",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold",children:"CORE."}),(0,r.jsx)("h4",{children:"El N\xfacleo de tu Empresa"})]}),(0,r.jsxs)("button",{onClick:()=>{e.push("/")},className:"absolute top-1/2 right-4 -translate-y-1/2 flex items-center gap-2 px-3 py-1.5 text-sm font-semibold bg-white text-primary rounded-md hover:bg-gray-200 transition","aria-label":"Cerrar sesi\xf3n",children:[(0,r.jsx)(s.A,{size:16}),(0,r.jsx)("span",{children:"Salir"})]})]})}},71847:(e,a,t)=>{t.d(a,{A:()=>d});var r=t(12115);let n=e=>{let a=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,a,t)=>t?t.toUpperCase():a.toLowerCase());return a.charAt(0).toUpperCase()+a.slice(1)},s=function(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return a.filter((e,a,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===a).join(" ").trim()};var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let o=(0,r.forwardRef)((e,a)=>{let{color:t="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:d,className:c="",children:l,iconNode:u,...m}=e;return(0,r.createElement)("svg",{ref:a,...i,width:n,height:n,stroke:t,strokeWidth:d?24*Number(o)/Number(n):o,className:s("lucide",c),...!l&&!(e=>{for(let a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[a,t]=e;return(0,r.createElement)(a,t)}),...Array.isArray(l)?l:[l]])}),d=(e,a)=>{let t=(0,r.forwardRef)((t,i)=>{let{className:d,...c}=t;return(0,r.createElement)(o,{ref:i,iconNode:a,className:s("lucide-".concat(n(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),d),...c})});return t.displayName=n(e),t}},84926:(e,a,t)=>{t.d(a,{A:()=>r});let r=(0,t(71847).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])},96440:(e,a,t)=>{t.d(a,{Ec:()=>n,N0:()=>i,sI:()=>o,tv:()=>d,w_:()=>s});let r="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function n(e){let a=await fetch("".concat(r,"/tanda-produccion/post-obtener-tanda-produccion-por-estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({estado:e})});if(!a.ok)throw Error("Error fetching tandas sugeridas");let t=await a.json();return console.log("tandas"+t.lineas_produccion),t.lineas_produccion}async function s(e,a){if(console.log("actualizar ot "+e+" a estado: "+a),console.log("actualizar ot "+e+" a estado: "+a),!(await fetch("".concat(r,"/tanda-produccion/post-update-tandas-produccion-estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_tandas:e,estado:a})})).ok)throw Error("Error updating tanda produccion")}async function i(){let e=await fetch("".concat(r,"/tanda-produccion/get-all-ordenes-produccion-aceptadas-por-linea-produccion"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error generating tanda");let a=await e.json();return console.log(a),a.lineas_produccion}async function o(e){console.log("Crear Tanda Produccion Manual: ",JSON.stringify({id_linea_produccion:e.id_linea_produccion,ordenes_produccion:e.ordenes_produccion}));let a=await fetch("".concat(r,"/tanda-produccion/post-crear-tandas-produccion-manual"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e=await a.json();throw console.log("Error creating tanda produccion manual:",e),Error(e.error||"Error creating tanda produccion manual")}return a.json()}async function d(){try{let e=await fetch("".concat(r,"/orden-produccion/planificador_op_daily"),{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok){let a=await e.json();throw Error(a.error||"Error fetching planificacion data")}return await e.json()}catch(e){throw console.log("error general: "+e),e}}}}]);