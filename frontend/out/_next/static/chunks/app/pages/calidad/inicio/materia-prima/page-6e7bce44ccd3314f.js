(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9674],{12873:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>l});var r=t(95155),s=t(51730),i=t(12115),o=t(60907);let n=()=>{let[e,a]=(0,i.useState)([]),[t,s]=(0,i.useState)(null),[n,l]=(0,i.useState)(null),[c,d]=(0,i.useState)(null),[m,p]=(0,i.useState)({estado:"",fecha_vencimiento:"",codigo_lote:"",observaciones:""}),[h,u]=(0,i.useState)(!1),[x,f]=(0,i.useState)(""),[g,j]=(0,i.useState)("success"),[b,y]=(0,i.useState)(!1),v=async()=>{try{let e=await (0,o.yz)();a(e),console.log(e)}catch(e){f("Error al cargar pedidos"),j("error"),y(!0)}};(0,i.useEffect)(()=>{v()},[]);let N=[{label:"Aceptado",value:"disponible"},{label:"Rechazado",value:"rechazado"},{label:"En cuarentena",value:"en_cuarentena"}],w=async e=>{u(!0);try{await (0,o.vn)(e.id,m.fecha_vencimiento,m.estado,m.observaciones,m.codigo_lote),f("Recepci\xf3n registrada correctamente."),j("success"),y(!0),l(null),p({estado:"",fecha_vencimiento:"",codigo_lote:"",observaciones:""}),v()}catch(e){f("Error al registrar la recepci\xf3n."),j("error"),y(!0)}u(!1)},_=async e=>{u(!0);try{await (0,o.Fn)(e),f("Pedido cancelado correctamente."),j("success"),y(!0),d(null),v()}catch(e){f("Error al cancelar el pedido."),j("error"),y(!0)}u(!1)};return(0,r.jsxs)("div",{className:"w-full max-w-2xl mx-auto p-2",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4 text-center text-primary",children:"Pedidos de materia prima"}),(0,r.jsx)("div",{className:"overflow-x-auto rounded-lg shadow",children:(0,r.jsxs)("table",{className:"min-w-full bg-white text-xs sm:text-sm",children:[(0,r.jsx)("thead",{className:"bg-primary text-white",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2",children:"ID"}),(0,r.jsx)("th",{className:"p-2",children:"Materia Prima"}),(0,r.jsx)("th",{className:"p-2",children:"Cantidad"}),(0,r.jsx)("th",{className:"p-2",children:"Proveedor"}),(0,r.jsx)("th",{className:"p-2",children:"Fecha"}),(0,r.jsx)("th",{className:"p-2",children:"Acciones"})]})}),(0,r.jsx)("tbody",{children:0===e.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,className:"text-center p-4",children:"No hay pedidos en espera de materia prima."})}):e.map(e=>(0,r.jsxs)(i.Fragment,{children:[(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("td",{className:"p-2 text-center",children:e.id_materia_prima}),(0,r.jsx)("td",{className:"p-2",children:e.nombre_materia_prima}),(0,r.jsx)("td",{className:"p-2 text-center",children:e.cantidad_total}),(0,r.jsxs)("td",{className:"p-2",children:[e.razon_social_proveedor," ",(0,r.jsx)("button",{className:"text-blue-600 underline",onClick:()=>s(t===e.id?null:e.id),children:"Ver m\xe1s"})]}),(0,r.jsx)("td",{className:"p-2 text-center",children:e.fecha_generacion_pedido.split(" ")[0]}),(0,r.jsxs)("td",{className:"p-2 flex flex-col gap-1 sm:flex-row",children:[(0,r.jsx)("button",{className:"text-s text-white rounded bg-green-600 p-1 hover:opacity-90 transition",onClick:()=>l(e.id),children:"Recibir"}),(0,r.jsx)("button",{className:"text-s text-white rounded bg-red-600 p-1 hover:opacity-90 transition",onClick:()=>d(e.id),children:"Cancelar"})]})]}),t===e.id&&(0,r.jsx)("tr",{className:"bg-gray-50",children:(0,r.jsx)("td",{colSpan:7,className:"p-2",children:(0,r.jsxs)("div",{className:"flex flex-col gap-1 text-xs sm:text-sm",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("b",{children:"Tel\xe9fono:"})," ",e.telefono_proveedor]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("b",{children:"Email:"})," ",e.email_proveedor]})]})})}),n===e.id&&(0,r.jsx)("tr",{className:"bg-green-50",children:(0,r.jsx)("td",{colSpan:7,className:"p-2",children:(0,r.jsxs)("form",{className:"flex flex-col gap-2",onSubmit:a=>{a.preventDefault(),w(e)},children:[(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsxs)("span",{children:[(0,r.jsx)("b",{children:"ID:"})," ",e.id_materia_prima]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("b",{children:"Materia Prima:"})," ",e.nombre_materia_prima]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("b",{children:"Cantidad:"})," ",e.cantidad_total]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("b",{children:"Proveedor:"})," ",e.razon_social_proveedor]}),(0,r.jsxs)("span",{children:[(0,r.jsx)("b",{children:"Fecha:"})," ",e.fecha_generacion_pedido.split(" ")[0]]})]}),(0,r.jsx)("label",{className:"text-sm font-medium",children:"Estado de recepci\xf3n"}),(0,r.jsxs)("select",{required:!0,className:"border rounded px-2 py-1",value:m.estado,onChange:e=>p(a=>({...a,estado:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"Selecciona estado"}),N.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))]}),e.expirable&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"Fecha de vencimiento "}),(0,r.jsx)("input",{type:"date",className:"border rounded px-2 py-1",required:!0,value:m.fecha_vencimiento,onChange:e=>p(a=>({...a,fecha_vencimiento:e.target.value}))})]}),(0,r.jsx)("label",{className:"text-sm font-medium",children:"C\xf3digo de lote"}),(0,r.jsx)("input",{type:"text",className:"border rounded px-2 py-1",required:!0,value:m.codigo_lote,onChange:e=>p(a=>({...a,codigo_lote:e.target.value}))}),(0,r.jsx)("label",{className:"text-sm font-medium",children:"Observaciones (opcional)"}),(0,r.jsx)("textarea",{className:"border rounded px-2 py-1",value:m.observaciones,onChange:e=>p(a=>({...a,observaciones:e.target.value}))}),(0,r.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,r.jsx)("button",{type:"submit",disabled:h,className:"bg-green-600 text-white px-4 py-1 rounded font-semibold",children:"Registrar"}),(0,r.jsx)("button",{type:"button",className:"bg-gray-400 text-white px-4 py-1 rounded font-semibold",onClick:()=>l(null),children:"Cancelar"})]})]})})}),c===e.id&&(0,r.jsx)("tr",{className:"bg-red-50",children:(0,r.jsx)("td",{colSpan:7,className:"p-2",children:(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("span",{children:"\xbfSeguro que quieres cancelar el pedido?"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{className:"bg-red-600 text-white px-4 py-1 rounded font-semibold",onClick:()=>_(e.id),children:"Confirmar"}),(0,r.jsx)("button",{className:"bg-gray-400 text-white px-4 py-1 rounded font-semibold",onClick:()=>d(null),children:"Volver"})]})]})})})]},e.id))})]})}),b&&(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:(0,r.jsxs)("div",{className:"rounded-lg p-6 shadow-lg w-80 text-center ".concat("error"===g?"bg-red-50 border border-red-300":"bg-green-50 border border-green-300"),children:[(0,r.jsx)("h3",{className:"text-lg font-bold mb-2 ".concat("error"===g?"text-red-600":"text-green-600"),children:"error"===g?"Error":"\xc9xito"}),(0,r.jsx)("p",{className:"mb-4 text-sm",children:x}),(0,r.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 rounded font-semibold ".concat("error"===g?"bg-red-600 text-white":"bg-green-600 text-white"," hover:opacity-90 transition"),children:"Cerrar"})]})})]})},l=()=>{async function e(){try{let e=await (0,o.Mm)();console.log("Materia prima aceptada:",e),window.location.reload()}catch(e){console.error("Error al aceptar la materia prima:",e)}console.log("Aceptar toda la materia prima")}return(0,r.jsxs)("div",{className:"min-h-screen bg-neutral-light",children:[(0,r.jsx)(s.default,{}),(0,r.jsx)("button",{onClick:()=>e(),className:"rounded bg-success p-2 text-white m-2 text-sm",children:" ACEPTAR TODO (solo para desarrollo)"}),(0,r.jsx)("main",{className:"p-6 space-y-4",children:(0,r.jsx)(n,{})})]})}},15239:(e,a,t)=>{"use strict";t.d(a,{default:()=>s.a});var r=t(54652),s=t.n(r)},20063:(e,a,t)=>{"use strict";var r=t(47260);t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}})},28448:(e,a,t)=>{Promise.resolve().then(t.bind(t,12873))},51730:(e,a,t)=>{"use strict";t.d(a,{default:()=>n});var r=t(95155);t(12115);var s=t(20063),i=t(84926),o=t(15239);let n=()=>{let e=(0,s.useRouter)();return(0,r.jsxs)("header",{className:"relative flex items-center justify-center py-3 text-center text-white",children:[(0,r.jsx)(o.default,{src:"/Banner.jpg",alt:"Banner",fill:!0,priority:!0,className:"object-cover "}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold",children:"CORE."}),(0,r.jsx)("h4",{children:"El N\xfacleo de tu Empresa"})]}),(0,r.jsxs)("button",{onClick:()=>{e.push("/")},className:"absolute top-1/2 right-4 -translate-y-1/2 flex items-center gap-2 px-3 py-1.5 text-sm font-semibold bg-white text-primary rounded-md hover:bg-gray-200 transition","aria-label":"Cerrar sesi\xf3n",children:[(0,r.jsx)(i.A,{size:16}),(0,r.jsx)("span",{})]})]})}},54652:(e,a,t)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),!function(e,a){for(var t in a)Object.defineProperty(e,t,{enumerable:!0,get:a[t]})}(a,{default:function(){return l},getImageProps:function(){return n}});let r=t(28140),s=t(75040),i=t(81356),o=r._(t(71124));function n(e){let{props:a}=(0,s.getImgProps)(e,{defaultLoader:o.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,t]of Object.entries(a))void 0===t&&delete a[e];return{props:a}}let l=i.Image},60907:(e,a,t)=>{"use strict";t.d(a,{$Z:()=>c,Fn:()=>l,Kb:()=>p,Mm:()=>d,OX:()=>i,UO:()=>m,vn:()=>n,yz:()=>o,zI:()=>s});let r="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function s(){let e=await fetch("".concat(r,"/gestion-materia-prima/all-proveedores-por-materia-prima"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching materia prima x proovedor");return(await e.json()).materias_primas}async function i(e){let{idMateriaPrima:a,idProveedor:t,cantidad:s}=e,i=await fetch("".concat(r,"/gestion-materia-prima/generar-compra-materia-prima"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_materia_prima:a,id_proveedor:t,cantidad_total:s})});if(!i.ok)throw Error((await i.json()).error||"Error al pedir materia prima");return i.json()}async function o(){let e=await fetch("".concat(r,"/gestion-materia-prima/pedido-materia-prima"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching pedidos materia prima");return(await e.json()).pedidos_materia_prima}async function n(e,a,t,s,i){console.log(e,a,t,s,i);let o=await fetch("".concat(r,"/gestion-materia-prima/update-actualizar-estado-lote"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_lote:e,fecha_vencimiento:a,nuevo_estado:t,observaciones:s,codigo_lote:i})});if(!o.ok)throw Error((await o.json()).error||"Error al actualizar el estado del pedido");return o.json()}async function l(e){let a=await fetch("".concat(r,"/gestion-materia-prima/rechazar-pedido-materia-prima"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_pedido:e})});if(!a.ok)throw Error((await a.json()).error||"Error al cancelar el pedido");return a.json()}async function c(){let e=await fetch("".concat(r,"/gestion-materia-prima/stock"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching stock materia prima");return(await e.json()).stock_materia_prima}async function d(){let e=await fetch("".concat(r,"/gestion-materia-prima/get-aceptar-materia-prima-automatico"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error accepting materia prima");return await e.json()}async function m(){let e=await fetch("".concat(r,"/gestion-materia-prima/get-all-lotes-materia-prima"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching stock materia prima");let a=await e.json();return console.log(a),a.materias_primas}async function p(e){let a=await fetch("".concat(r,"/gestion-materia-prima/post-pdf-trazabilidad-lote"),{method:"POST",headers:{"Content-Type":"application/pdf"},body:JSON.stringify({lote_id:e})});if(!a.ok)throw Error("Error fetching PDF");let t=await a.text();return console.log("Blob del PDF:",t),t}},71847:(e,a,t)=>{"use strict";t.d(a,{A:()=>l});var r=t(12115);let s=e=>{let a=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,a,t)=>t?t.toUpperCase():a.toLowerCase());return a.charAt(0).toUpperCase()+a.slice(1)},i=function(){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return a.filter((e,a,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===a).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,r.forwardRef)((e,a)=>{let{color:t="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:l,className:c="",children:d,iconNode:m,...p}=e;return(0,r.createElement)("svg",{ref:a,...o,width:s,height:s,stroke:t,strokeWidth:l?24*Number(n)/Number(s):n,className:i("lucide",c),...!d&&!(e=>{for(let a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0})(p)&&{"aria-hidden":"true"},...p},[...m.map(e=>{let[a,t]=e;return(0,r.createElement)(a,t)}),...Array.isArray(d)?d:[d]])}),l=(e,a)=>{let t=(0,r.forwardRef)((t,o)=>{let{className:l,...c}=t;return(0,r.createElement)(n,{ref:o,iconNode:a,className:i("lucide-".concat(s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),l),...c})});return t.displayName=s(e),t}},84926:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(71847).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])}},e=>{e.O(0,[1356,8441,1255,7358],()=>e(e.s=28448)),_N_E=e.O()}]);