(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7823],{51730:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});var s=t(95155);t(12115);let r=()=>(0,s.jsxs)("header",{className:"bg-gradient-primary text-white py-3 text-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold",children:"CORE."}),(0,s.jsx)("h4",{children:"Gestion de Empresas"})]})},64954:(e,a,t)=>{"use strict";async function s(){let e=await fetch("".concat("https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd","/productos"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching productos");return(await e.json()).productos}t.d(a,{T:()=>s})},66256:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>p});var s=t(95155),r=t(12115);let i="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function l(){let e=await fetch("".concat(i,"/gestion-linea-produccion/get-all-productos-aceptados-por-linea-produccion"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching lineas de produccion");let a=await e.json();return Array.isArray(a.lineas_produccion)?a.lineas_produccion:[]}async function c(e,a){if(console.log("actualizar ot "+e+" a estado: "+a),!(await fetch("".concat(i,"/gestion-linea-produccion/update-linea-produccion-activa"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,nuevo_estado:a})})).ok)throw Error("Error updating linea de produccion")}async function n(e){var a;let t=await fetch("".concat(i,"/gestion-linea-produccion/update-datos-linea-produccion"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,nombre:e.nombre,activa:e.activa,descripcion:e.descripcion,capacidad_maxima_kg:e.capacidad_maxima_kg,ids_productos:null==(a=e.productos)?void 0:a.map(e=>e.id)})});if(!t.ok)throw Error((await t.json()).error||"Error al actualizar la linea de produccion");return t.json()}async function d(e){let a={nombre:e.nombre,descripcion:e.descripcion,capacidad_maxima_kg:e.capacidad_maxima_kg,activa:e.activa,ids_productos:e.productos},t=await fetch("".concat(i,"/gestion-linea-produccion/crear-linea-produccion"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok)throw Error((await t.json()).error||"Error al crear la linea de produccion");return t.json()}var o=t(64954);function x(e){let{lineas:a,onUpdated:t}=e,[i,l]=(0,r.useState)(null),[d,o]=(0,r.useState)(null),[x,m]=(0,r.useState)(null),[p,h]=(0,r.useState)(a||[]);r.useEffect(()=>h(a||[]),[a]);let g=async(e,a)=>{try{o(e),await c(e,a),h(t=>t.map(t=>t.id===e?{...t,estado:a}:t)),m(null),t&&t()}catch(e){console.error(e),alert(j(e)||"No se pudo actualizar el estado. Intenta de nuevo.")}finally{o(null)}},b=async e=>{if(e.id)try{o(e.id),await n(e),h(a=>a.map(a=>a.id===e.id?e:a)),l(null),t&&t()}catch(e){console.error(e),alert(j(e)||"Error actualizando la l\xednea")}finally{o(null)}};function j(e){if(!e)return null;if("string"==typeof e)return e;if("object"==typeof e&&null!==e){if("string"==typeof e.message)return e.message;if("string"==typeof e.error)return e.error}return null}return(0,s.jsx)("div",{className:"p-3",children:0===p.length?(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"No hay l\xedneas de producci\xf3n"}):(0,s.jsx)("ul",{className:"space-y-3",children:p.map(e=>(0,s.jsxs)("li",{className:"bg-white rounded-lg shadow p-3 flex flex-col gap-3 ".concat(e.activa?"border-l-4 border-green-500":"opacity-70 border-l-4 border-red-300"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-gray-700 font-semibold",children:e.nombre}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:e.descripcion})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("span",{className:"text-xs px-2 py-1 rounded ".concat(e.activa?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:e.activa?"Activa":"Inactiva"})})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{className:"flex-1 bg-blue-500 text-white rounded px-3 py-2 text-sm",onClick:()=>{var a;return l(i===e.id?null:null!=(a=e.id)?a:null)},children:i===e.id?"Cancelar edici\xf3n":"Editar l\xednea"}),(0,s.jsx)("button",{className:"flex-1 ".concat(e.activa?"bg-yellow-500 text-black":"bg-green-600 text-white"," rounded px-3 py-2 text-sm"),onClick:()=>{var a;return m(null!=(a=e.id)?a:null)},children:e.activa?"Desactivar":"Activar"})]}),x===e.id&&(0,s.jsxs)("div",{className:"bg-gray-50 rounded p-2",children:[(0,s.jsxs)("div",{className:"text-sm",children:["\xbfSeguro que quieres ",e.activa?"desactivar":"activar"," la l\xednea ",(0,s.jsx)("b",{children:e.nombre}),"?"]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,s.jsx)("button",{className:"flex-1 bg-red-500 text-white rounded px-2 py-1 text-sm",onClick:()=>m(null),children:"Cancelar"}),(0,s.jsx)("button",{className:"flex-1 bg-primary text-white rounded px-2 py-1 text-sm",onClick:()=>g(e.id,!e.activa),children:d===e.id?"Procesando...":e.activa?"Confirmar desactivar":"Confirmar activar"})]})]}),i===e.id&&(0,s.jsx)("div",{className:"bg-gray-50 rounded p-3",children:(0,s.jsx)(u,{linea:e,onCancel:()=>l(null),onSave:b,loadingId:d})}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["Capacidad m\xe1xima de producci\xf3n: ",e.capacidad_maxima_kg," KG"]}),e.productos&&e.productos.length>0&&(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,s.jsx)("div",{className:"font-semibold text-xs mb-1",children:"Productos asignados"}),(0,s.jsx)("ul",{className:"list-disc list-inside text-xs",children:e.productos.map(e=>(0,s.jsx)("li",{children:e.nombre},e.id))})]})]})]},e.id))})})}function u(e){let{linea:a,onCancel:t,onSave:i,loadingId:l}=e,[c,n]=(0,r.useState)(a.nombre),[d,x]=(0,r.useState)(a.descripcion),[u,m]=(0,r.useState)(a.capacidad_maxima_kg.toString()),[p,h]=(0,r.useState)(a.activa),[g,b]=(0,r.useState)(a.productos||[]),[j,f]=(0,r.useState)([]),[v,N]=(0,r.useState)(!1),[y,w]=(0,r.useState)(!1),[C,k]=(0,r.useState)("");return r.useEffect(()=>{N(!0),(0,o.T)().then(f).catch(()=>f([])).finally(()=>N(!1))},[]),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[y&&(0,s.jsxs)("div",{className:"bg-red-100 text-red-700 rounded p-2 text-xs mb-2 flex justify-between items-center",children:[(0,s.jsx)("span",{children:C}),(0,s.jsx)("button",{className:"ml-2 text-xs",onClick:()=>w(!1),children:"X"})]}),(0,s.jsx)("label",{className:"text-xs",children:"Nombre"}),(0,s.jsx)("input",{className:"w-full rounded border px-2 py-1 text-sm",value:c,onChange:e=>n(e.target.value)}),(0,s.jsx)("label",{className:"text-xs",children:"Descripci\xf3n"}),(0,s.jsx)("textarea",{className:"w-full rounded border px-2 py-1 text-sm",value:d,onChange:e=>x(e.target.value)}),(0,s.jsx)("label",{className:"text-xs",children:"Capacidad m\xe1xima (kg)"}),(0,s.jsx)("input",{type:"number",className:"w-full rounded border px-2 py-1 text-sm",value:u,onChange:e=>m(e.target.value),min:1,max:1e3}),(0,s.jsx)("label",{className:"text-xs",children:"Activa"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("input",{id:"activa-edit",type:"checkbox",checked:p,onChange:e=>h(e.target.checked)}),(0,s.jsx)("label",{htmlFor:"activa-edit",className:"text-sm",children:"La l\xednea est\xe1 activa"})]}),(0,s.jsx)("label",{className:"text-xs",children:"Productos"}),v?(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Cargando productos..."}):(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-32 overflow-auto",children:j.map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-2 text-xs bg-gray-50 rounded px-2 py-1",children:[(0,s.jsx)("input",{type:"checkbox",checked:g.some(a=>a.id===e.id),onChange:()=>{b(a=>a.some(a=>a.id===e.id)?a.filter(a=>a.id!==e.id):[...a,e])}}),(0,s.jsx)("span",{children:e.nombre})]},e.id))}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,s.jsx)("button",{className:"flex-1 bg-gray-200 rounded px-2 py-1 text-sm",onClick:t,children:"Cancelar"}),(0,s.jsx)("button",{className:"flex-1 bg-primary text-white rounded px-2 py-1 text-sm",onClick:()=>{let e=Number(u);if(!c.trim()||!d.trim()||!u||isNaN(e)||e<1||e>1e3||0===g.length){k("Todos los campos son obligatorios. Capacidad debe ser entre 1 y 1000. Selecciona al menos un producto."),w(!0);return}i({...a,nombre:c,descripcion:d,capacidad_maxima_kg:e,activa:p,productos:g})},disabled:l===a.id,children:l===a.id?"Guardando...":"Guardar"})]})]})}var m=t(51730);function p(){let[e,a]=(0,r.useState)([]),[t,i]=(0,r.useState)(!1),[c,n]=(0,r.useState)(null),u=async()=>{i(!0),n(null);try{let e=await l();a(e),console.log(e)}catch(e){console.error(e),n("No se pudieron cargar las l\xedneas")}finally{i(!1)}},[p,h]=(0,r.useState)(!1),[g,b]=(0,r.useState)([]),[j,f]=(0,r.useState)(!1),[v,N]=(0,r.useState)(""),[y,w]=(0,r.useState)(""),[C,k]=(0,r.useState)(""),[S,_]=(0,r.useState)([]),[E,T]=(0,r.useState)(!0),z=async()=>{h(!0);try{let e=await (0,o.T)();b(e||[])}catch(e){console.error(e),b([])}},O=async()=>{let e=[];v.trim()||e.push("El nombre es obligatorio."),y.trim()||e.push("La descripci\xf3n es obligatoria.");let a=Number(C);if(!C||Number.isNaN(a)?e.push("La capacidad en kg es obligatoria."):(a<1||a>1e3)&&e.push("La capacidad debe ser entre 1 y 1000 kg."),0===S.length&&e.push("Debe seleccionar al menos un producto."),e.length>0){L(e),A(!0);return}f(!0);try{let e={nombre:v,descripcion:y,productos:S,capacidad_maxima_kg:C?Number(C):void 0,activa:E};await d(e),N(""),w(""),k(""),_([]),T(!0),h(!1),await u()}catch(e){console.error(e),alert("No se pudo crear la l\xednea. Revisa la consola.")}finally{f(!1)}},[P,A]=(0,r.useState)(!1),[G,L]=(0,r.useState)([]);return(0,r.useEffect)(()=>{u()},[]),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.A,{}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("h1",{className:"text-xxl font-bold text-center mb-3",children:"L\xedneas de Producci\xf3n"}),(0,s.jsx)("div",{className:"mb-4 flex flex-col gap-2",children:p?(0,s.jsxs)(s.Fragment,{children:[P&&(0,s.jsx)("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-4 w-11/12 max-w-md",children:[(0,s.jsx)("div",{className:"font-semibold mb-2",children:"Errores en el formulario"}),(0,s.jsx)("ul",{className:"list-disc list-inside text-sm text-red-600",children:G.map((e,a)=>(0,s.jsx)("li",{children:e},a))}),(0,s.jsx)("div",{className:"mt-4 text-right",children:(0,s.jsx)("button",{className:"px-3 py-1 bg-primary text-white rounded",onClick:()=>A(!1),children:"Cerrar"})})]})}),(0,s.jsxs)("div",{className:"bg-white p-3 rounded shadow",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("div",{className:"font-semibold",children:"Nueva l\xednea de producci\xf3n"}),(0,s.jsx)("button",{className:"text-sm text-gray-500",onClick:()=>h(!1),children:"Cerrar"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("label",{className:"text-xs",children:"Nombre"}),(0,s.jsx)("input",{className:"w-full rounded border px-2 py-1 text-sm",value:v,onChange:e=>N(e.target.value)}),(0,s.jsx)("label",{className:"text-xs",children:"Descripci\xf3n"}),(0,s.jsx)("textarea",{className:"w-full rounded border px-2 py-1 text-sm",value:y,onChange:e=>w(e.target.value)}),(0,s.jsx)("label",{className:"text-xs",children:"Capacidad m\xe1xima (kg)"}),(0,s.jsx)("input",{type:"number",className:"w-full rounded border px-2 py-1 text-sm",value:C,onChange:e=>k(e.target.value)}),(0,s.jsx)("label",{className:"text-xs",children:"Activa"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{id:"activa",type:"checkbox",checked:E,onChange:e=>T(e.target.checked)}),(0,s.jsx)("label",{htmlFor:"activa",className:"text-sm",children:"La l\xednea estar\xe1 activa"})]}),(0,s.jsx)("label",{className:"text-xs",children:"Productos (selecciona)"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-auto",children:g.map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm bg-gray-50 rounded px-2 py-1",children:[(0,s.jsx)("input",{type:"checkbox",checked:S.includes(e.id),onChange:()=>{var a;return a=e.id,void _(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a])}}),(0,s.jsx)("span",{children:e.nombre})]},e.id))}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,s.jsx)("button",{className:"flex-1 bg-gray-200 rounded px-3 py-2",onClick:()=>h(!1),children:"Cancelar"}),(0,s.jsx)("button",{className:"flex-1 bg-primary text-white rounded px-3 py-2",onClick:O,disabled:j,children:j?"Creando...":"Crear"})]})]})]})]}):(0,s.jsx)("button",{className:"bg-primary text-white px-3 py-2 rounded",onClick:z,children:"Crear nueva l\xednea de producci\xf3n"})}),t&&(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Cargando..."}),c&&(0,s.jsx)("div",{className:"text-sm text-red-500",children:c}),(0,s.jsx)(x,{lineas:e,onUpdated:u})]})]})}},94235:(e,a,t)=>{Promise.resolve().then(t.bind(t,66256))}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=94235)),_N_E=e.O()}]);