(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[260],{20063:(e,t,a)=>{"use strict";var o=a(47260);a.o(o,"usePathname")&&a.d(t,{usePathname:function(){return o.usePathname}}),a.o(o,"useRouter")&&a.d(t,{useRouter:function(){return o.useRouter}})},20154:(e,t,a)=>{Promise.resolve().then(a.bind(a,29625))},28569:(e,t,a)=>{"use strict";a.d(t,{$1:()=>c,LP:()=>h,NV:()=>n,OV:()=>i,X6:()=>r,dC:()=>d,lm:()=>s,s1:()=>l});let o="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function r(){let e=await fetch("".concat(o,"/crear-orden-venta"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching productos");return(await e.json()).data}async function s(e){console.log("Creando nuevo pedido con data:",e);let t=await fetch("".concat(o,"/crear-orden-venta"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log(JSON.stringify(e)),!t.ok){let e=await t.json();throw Error("Error creating pedido: ".concat(t.status," - ").concat(JSON.stringify(e)))}return t.json()}async function n(){let e=await fetch("".concat(o,"/get-orden-venta"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching solicitudes de venta");return(await e.json()).orden_ventas_pendientes}async function i(e,t){let a=await fetch("".concat(o,"/crear-orden-venta/update-estado-orden-venta"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_pedido:e,estado:t})});if(!a.ok){let e=await a.json();throw Error("Error updating estado: ".concat(a.status," - ").concat(JSON.stringify(e)))}return a.json()}async function d(){let e=await fetch("".concat(o,"/gestion-envios/get-pedidos-por-zona"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching pedidos terminados");return(await e.json()).zonas}async function l(e){let t=await fetch("".concat(o,"/gestion-envios/post-get-envios-por-estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({estado:e})});if(!t.ok)throw Error("Error fetching pedidos asignados");let a=await t.json();return console.log("Response Data:",a),a.vehiculos}async function c(e){let t=await fetch("".concat(o,"/gestion-envios/post-update-despachar-all-envios-de-vehiculo"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_vehiculo:e})});if(!t.ok){let e=await t.json();throw Error("Error updating estado envio: ".concat(t.status," - ").concat(JSON.stringify(e)))}return t.json()}async function h(){let e=await fetch("".concat(o,"/crear-orden-venta/get-orden-venta-atrasada"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw console.error("Failed to fetch pedidos reprogramados:",e.statusText),Error("Error fetching pedidos reprogramados");return await e.json()}},29625:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(95155),r=a(51730),s=a(12115),n=a(62386),i=a(28569);let d=["zona norte","zona sur","zona este","zona oeste"],l=()=>{let[e,t]=(0,s.useState)([]),[a,l]=(0,s.useState)(!0),[c,h]=(0,s.useState)([]),[u,p]=(0,s.useState)(null),[m,g]=(0,s.useState)(""),[f,x]=(0,s.useState)({}),[j,v]=(0,s.useState)(!1),[b,y]=(0,s.useState)(!1),[w,_]=(0,s.useState)({title:"",message:"",isError:!1}),[N,k]=(0,s.useState)(!1),E=async()=>{l(!0);try{let e=(await (0,i.dC)()).flatMap(e=>e.ordenes_venta.map(t=>({id_pedido_venta:t.id_orden_venta,id_cliente:t.id_cliente,razon_social:t.razon_social,email:t.email,nombre_contacto:t.nombre_contacto,apellido_contacto:t.apellido_contacto,telefono:t.telefono,productos:t.productos,fecha_pedido:t.fecha_pedido,fecha_entrega:t.fecha_entrega,valor_total_pedido:t.valor_total_pedido,peso_total_kg:t.peso_total_pedido,direccion_entrega:t.direccion_entrega,zona:e.zona})));t(e);let a=await (0,n.wq)();h(a)}catch(e){console.error("Error al cargar datos:",e),_({title:"Error",message:"No se pudieron cargar los datos. Intente de nuevo.",isError:!0}),y(!0)}finally{l(!1)}};(0,s.useEffect)(()=>{E()},[]);let C=s.useMemo(()=>c.find(e=>e.id===u)||null,[u,c]),S=s.useMemo(()=>m?e.filter(e=>e.zona.toLowerCase()===m.toLowerCase()):[],[m,e]),z=s.useMemo(()=>S.reduce((e,t)=>f[t.id_pedido_venta]?e+(t.peso_total_kg||0):e,0),[f,S]),T=C?C.capacidad_kg-z:0,O=async()=>{if(!C)return;k(!0),v(!1);let e=Object.keys(f).filter(e=>!0===f[Number(e)]).map(Number);console.log("Asignando env\xedo con datos:",{id_vehiculo:C.id,ids_pedidos:e});try{await (0,n.DW)({id_vehiculo:C.id,ids_pedidos:e}),_({title:"\xc9xito",message:"El env\xedo se ha asignado correctamente.",isError:!1}),p(null),g(""),x({}),await E()}catch(e){console.error("Error al crear env\xedo:",e),_({title:"Error",message:"Hubo un problema al asignar el env\xedo. Por favor, intente de nuevo.",isError:!0})}finally{k(!1),y(!0)}},P=s.useMemo(()=>e.filter(e=>f[e.id_pedido_venta]),[e,f]);return(0,o.jsxs)("div",{children:[(0,o.jsx)(r.default,{}),(0,o.jsxs)("div",{className:"p-4 space-y-6",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold mb-4 text-center",children:"Gesti\xf3n de Env\xedos"}),(0,o.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"flota",className:"block text-sm font-medium text-gray-700 mb-1",children:"Seleccionar Flota"}),(0,o.jsxs)("select",{id:"flota",value:null!=u?u:"",onChange:e=>{p(Number(e.target.value)),x({})},className:"w-full p-2 border rounded-md bg-white shadow-sm",children:[(0,o.jsx)("option",{value:"",disabled:!0,children:"-- Seleccione un veh\xedculo --"}),c.map(e=>(0,o.jsxs)("option",{value:e.id,children:[e.nombre_conductor," - ",e.modelo," (Cap: ",e.capacidad_kg," kg)"]},e.id))]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"zona",className:"block text-sm font-medium text-gray-700 mb-1",children:"Seleccionar Zona"}),(0,o.jsxs)("select",{id:"zona",value:m,onChange:e=>{g(e.target.value),x({})},className:"w-full p-2 border rounded-md bg-white shadow-sm",children:[(0,o.jsx)("option",{value:"",disabled:!0,children:"-- Seleccione una zona --"}),d.map(e=>(0,o.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]})]}),C&&(0,o.jsxs)("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg text-sm",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Veh\xedculo:"})," ",C.modelo]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Capacidad Total:"})," ",C.capacidad_kg," kg"]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Peso Seleccionado:"})," ",z.toFixed(2)," kg"]}),(0,o.jsxs)("p",{className:"font-bold ".concat(T<0?"text-red-600":"text-green-600"),children:[(0,o.jsx)("strong",{children:"Capacidad Restante:"})," ",T.toFixed(2)," kg"]})]}),a?(0,o.jsx)("p",{className:"text-center text-gray-500",children:"Cargando pedidos..."}):(0,o.jsxs)("div",{className:"space-y-3",children:[(0,o.jsxs)("h3",{className:"text-lg font-semibold",children:["Pedidos para ",m||"..."]}),S.length>0?S.map(e=>{let t=!!f[e.id_pedido_venta];return(0,o.jsxs)("div",{className:"p-3 rounded-lg shadow-sm border flex items-start gap-4 ".concat(!t&&T<(e.peso_total_kg||0)?"bg-gray-100 opacity-60":"bg-white"),children:[(0,o.jsx)("input",{type:"checkbox",checked:t,onChange:()=>((e,t)=>{if(!C){_({title:"Error",message:"Primero debe seleccionar un veh\xedculo.",isError:!0}),y(!0);return}let a=!!f[e];if(!a&&z+t>C.capacidad_kg){_({title:"Capacidad Excedida",message:"No se puede agregar este pedido, excede la capacidad del veh\xedculo.",isError:!0}),y(!0);return}x(t=>({...t,[e]:!a}))})(e.id_pedido_venta,e.peso_total_kg||0),disabled:!t&&T<(e.peso_total_kg||0),className:"mt-1 h-5 w-5"}),(0,o.jsxs)("div",{className:"flex-grow",children:[(0,o.jsxs)("p",{className:"font-bold",children:["Pedido #",e.id_pedido_venta," - ",e.razon_social]}),(0,o.jsx)("p",{className:"text-sm text-gray-600",children:e.direccion_entrega}),(0,o.jsxs)("p",{className:"text-sm",children:[(0,o.jsx)("strong",{children:"Peso:"})," ",e.peso_total_kg||0," kg"]})]})]},e.id_pedido_venta)}):(0,o.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No hay pedidos para la zona seleccionada o seleccione una zona."})]}),(0,o.jsx)("button",{onClick:()=>{if(!C||!m||0===Object.keys(f).filter(e=>f[Number(e)]).length){_({title:"Datos incompletos",message:"Debe seleccionar un veh\xedculo, una zona y al menos un pedido.",isError:!0}),y(!0);return}v(!0)},disabled:N||!C||!m||0===Object.keys(f).filter(e=>f[Number(e)]).length,className:"w-full bg-primary text-white py-3 rounded-lg font-bold hover:bg-opacity-90 transition-opacity disabled:opacity-50",children:N?"Procesando...":"Finalizar Asignaci\xf3n"}),j&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,o.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Confirmar Asignaci\xf3n"}),(0,o.jsxs)("div",{className:"text-sm space-y-2 mb-6",children:[(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Veh\xedculo:"})," ",null==C?void 0:C.modelo]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Zona:"})," ",m]}),(0,o.jsxs)("p",{children:[(0,o.jsx)("strong",{children:"Peso Total:"})," ",z.toFixed(2)," kg"]}),(0,o.jsxs)("p",{className:"font-bold",children:["Pedidos a asignar (",P.length,"):"]}),(0,o.jsx)("ul",{className:"list-disc list-inside max-h-40 overflow-y-auto",children:P.map(e=>(0,o.jsxs)("li",{children:["#",e.id_pedido_venta," - ",e.razon_social]},e.id_pedido_venta))})]}),(0,o.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,o.jsx)("button",{onClick:()=>v(!1),className:"px-4 py-2 rounded-md bg-gray-200",children:"Cancelar"}),(0,o.jsx)("button",{onClick:O,className:"px-4 py-2 rounded-md bg-green-600 text-white",children:"Confirmar"})]})]})}),b&&(0,o.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,o.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center border-t-4 ".concat(w.isError?"border-red-500":"border-green-500"),children:[(0,o.jsx)("h3",{className:"text-xl font-bold mb-4",children:w.title}),(0,o.jsx)("p",{className:"mb-6",children:w.message}),(0,o.jsx)("button",{onClick:()=>y(!1),className:"w-full px-4 py-2 rounded-md text-white ".concat(w.isError?"bg-red-600":"bg-green-600"),children:"Cerrar"})]})})]})]})}},51730:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});var o=a(95155);a(12115);var r=a(20063),s=a(84926);let n=()=>{let e=(0,r.useRouter)();return(0,o.jsxs)("header",{className:"bg-gradient-primary text-white py-3 text-center relative flex items-center justify-center",children:[(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("h1",{className:"text-4xl font-bold",children:"CORE."}),(0,o.jsx)("h4",{children:"El N\xfacleo de tu Empresa"})]}),(0,o.jsxs)("button",{onClick:()=>{e.push("/")},className:"absolute top-1/2 right-4 -translate-y-1/2 flex items-center gap-2 px-3 py-1.5 text-sm font-semibold bg-white text-primary rounded-md hover:bg-gray-200 transition","aria-label":"Cerrar sesi\xf3n",children:[(0,o.jsx)(s.A,{size:16}),(0,o.jsx)("span",{children:"Salir"})]})]})}},62386:(e,t,a)=>{"use strict";a.d(t,{DW:()=>n,Lm:()=>r,wq:()=>s});let o="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function r(e){let t=await fetch("".concat(o,"/gestion-vehiculos/post-registrar-vehiculo"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Error al crear la flota");return t.json()}async function s(){let e=await fetch("".concat(o,"/gestion-vehiculos/get-vehiculos-disponibles"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching flotas");let t=await e.json();return Array.isArray(t.vehiculos)?t.vehiculos:[]}async function n(e){let t={id_vehiculo:e.id_vehiculo,ordenes_venta:e.ids_pedidos.map(e=>({id_orden_venta:e}))},a=await fetch("".concat(o,"/gestion-envios/post-crear-tanda-envios"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error((await a.json()).error||"Error al crear el envio");return a.json()}},71847:(e,t,a)=>{"use strict";a.d(t,{A:()=>d});var o=a(12115);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,o.forwardRef)((e,t)=>{let{color:a="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:d,className:l="",children:c,iconNode:h,...u}=e;return(0,o.createElement)("svg",{ref:t,...n,width:r,height:r,stroke:a,strokeWidth:d?24*Number(i)/Number(r):i,className:s("lucide",l),...!c&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(u)&&{"aria-hidden":"true"},...u},[...h.map(e=>{let[t,a]=e;return(0,o.createElement)(t,a)}),...Array.isArray(c)?c:[c]])}),d=(e,t)=>{let a=(0,o.forwardRef)((a,n)=>{let{className:d,...l}=a;return(0,o.createElement)(i,{ref:n,iconNode:t,className:s("lucide-".concat(r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),d),...l})});return a.displayName=r(e),a}},84926:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});let o=(0,a(71847).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=20154)),_N_E=e.O()}]);