(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[260],{20063:(e,t,o)=>{"use strict";var a=o(47260);o.o(a,"usePathname")&&o.d(t,{usePathname:function(){return a.usePathname}}),o.o(a,"useRouter")&&o.d(t,{useRouter:function(){return a.useRouter}})},20154:(e,t,o)=>{Promise.resolve().then(o.bind(o,29625))},28569:(e,t,o)=>{"use strict";o.d(t,{$1:()=>l,LP:()=>p,NV:()=>s,OV:()=>i,Sr:()=>h,UE:()=>g,X6:()=>r,dC:()=>d,gq:()=>u,lm:()=>n,s1:()=>c});let a="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function r(){let e=await fetch("".concat(a,"/crear-orden-venta"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching productos");return(await e.json()).data}async function n(e){console.log("Creando nuevo pedido con data:",e);let t=await fetch("".concat(a,"/crear-orden-venta"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log(JSON.stringify(e)),!t.ok){let e=await t.json();throw Error("Error creating pedido: ".concat(t.status," - ").concat(JSON.stringify(e)))}return t.json()}async function s(){let e=await fetch("".concat(a,"/get-orden-venta"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching solicitudes de venta");return(await e.json()).orden_ventas_pendientes}async function i(e,t){let o=await fetch("".concat(a,"/crear-orden-venta/update-estado-orden-venta"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_pedido:e,estado:t})});if(!o.ok){let e=await o.json();throw Error("Error updating estado: ".concat(o.status," - ").concat(JSON.stringify(e)))}return o.json()}async function d(){let e=await fetch("".concat(a,"/gestion-envios/get-pedidos-por-zona"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching pedidos terminados");return(await e.json()).zonas}async function c(e){let t=await fetch("".concat(a,"/gestion-envios/post-get-envios-por-estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({estado:e})});if(!t.ok)throw Error("Error fetching pedidos asignados");let o=await t.json();return console.log("Response Data:",o),o.vehiculos}async function l(e){let t=await fetch("".concat(a,"/gestion-envios/post-update-despachar-all-envios-de-vehiculo"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_vehiculo:e})});if(!t.ok){let e=await t.json();throw Error("Error updating estado envio: ".concat(t.status," - ").concat(JSON.stringify(e)))}return t.json()}async function h(e,t){let o={id_envio:e,estado:t};console.log(JSON.stringify(o));let r=await fetch("".concat(a,"/gestion-envios/post-update-estado-envio"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok){let e=await r.json();throw Error("Error updating estado envio: ".concat(r.status," - ").concat(JSON.stringify(e)))}return r.json()}async function p(){let e=await fetch("".concat(a,"/crear-orden-venta/get-orden-venta-atrasada"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw console.error("Failed to fetch pedidos reprogramados:",e.statusText),Error("Error fetching pedidos reprogramados");return await e.json()}async function u(){let e=await fetch("".concat(a,"/get-orden-venta/get-orden-venta-en-supervision-por-urgencia"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching pedidos urgentes");return(await e.json()).orden_ventas_pendiente_supervision_urgencia}async function g(e){let t=await fetch("".concat(a,"/get-orden-venta/planificador_ordenes_produccion_simulacion_ov"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_orden_venta:e})});if(!t.ok)throw Error("Error fetching ordenes que se retrasan");return(await t.json()).afectadas}},29625:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>c});var a=o(95155),r=o(51730),n=o(12115),s=o(62386),i=o(28569);let d=["zona norte","zona sur","zona este","zona oeste"],c=()=>{let[e,t]=(0,n.useState)([]),[o,c]=(0,n.useState)(!0),[l,h]=(0,n.useState)([]),[p,u]=(0,n.useState)(null),[g,m]=(0,n.useState)(""),[f,x]=(0,n.useState)({}),[v,j]=(0,n.useState)(!1),[y,b]=(0,n.useState)(!1),[_,w]=(0,n.useState)({title:"",message:"",isError:!1}),[N,E]=(0,n.useState)(!1),k=async()=>{c(!0);try{let e=(await (0,i.dC)()).flatMap(e=>e.ordenes_venta.map(t=>({id_pedido_venta:t.id_orden_venta,id_cliente:t.id_cliente,razon_social:t.razon_social,email:t.email,nombre_contacto:t.nombre_contacto,apellido_contacto:t.apellido_contacto,telefono:t.telefono,productos:t.productos,fecha_pedido:t.fecha_pedido,fecha_entrega:t.fecha_entrega,valor_total_pedido:t.valor_total_pedido,peso_total_kg:t.peso_total_pedido,direccion_entrega:t.direccion_entrega,zona:e.zona})));t(e);let o=await (0,s.wq)();h(o)}catch(e){console.error("Error al cargar datos:",e),w({title:"Error",message:"No se pudieron cargar los datos. Intente de nuevo.",isError:!0}),b(!0)}finally{c(!1)}};(0,n.useEffect)(()=>{k()},[]);let C=n.useMemo(()=>l.find(e=>e.id===p)||null,[p,l]),S=n.useMemo(()=>g?e.filter(e=>e.zona.toLowerCase()===g.toLowerCase()):[],[g,e]),T=n.useMemo(()=>S.reduce((e,t)=>f[t.id_pedido_venta]?e+(t.peso_total_kg||0):e,0),[f,S]),O=C?C.capacidad_kg-T:0,z=async()=>{if(!C)return;E(!0),j(!1);let e=Object.keys(f).filter(e=>!0===f[Number(e)]).map(Number);console.log("Asignando env\xedo con datos:",{id_vehiculo:C.id,ids_pedidos:e});try{await (0,s.DW)({id_vehiculo:C.id,ids_pedidos:e}),w({title:"\xc9xito",message:"El env\xedo se ha asignado correctamente.",isError:!1}),u(null),m(""),x({}),await k()}catch(e){console.error("Error al crear env\xedo:",e),w({title:"Error",message:"Hubo un problema al asignar el env\xedo. Por favor, intente de nuevo.",isError:!0})}finally{E(!1),b(!0)}},P=n.useMemo(()=>e.filter(e=>f[e.id_pedido_venta]),[e,f]);return(0,a.jsxs)("div",{children:[(0,a.jsx)(r.default,{}),(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4 text-center",children:"Gesti\xf3n de Env\xedos"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"flota",className:"block text-sm font-medium text-gray-700 mb-1",children:"Seleccionar Flota"}),(0,a.jsxs)("select",{id:"flota",value:null!=p?p:"",onChange:e=>{u(Number(e.target.value)),x({})},className:"w-full p-2 border rounded-md bg-white shadow-sm",children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"-- Seleccione un veh\xedculo --"}),l.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.nombre_conductor," - ",e.modelo," (Cap: ",e.capacidad_kg," kg)"]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"zona",className:"block text-sm font-medium text-gray-700 mb-1",children:"Seleccionar Zona"}),(0,a.jsxs)("select",{id:"zona",value:g,onChange:e=>{m(e.target.value),x({})},className:"w-full p-2 border rounded-md bg-white shadow-sm",children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"-- Seleccione una zona --"}),d.map(e=>(0,a.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))]})]})]}),C&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Veh\xedculo:"})," ",C.modelo]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Capacidad Total:"})," ",C.capacidad_kg," kg"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Peso Seleccionado:"})," ",T.toFixed(2)," kg"]}),(0,a.jsxs)("p",{className:"font-bold ".concat(O<0?"text-red-600":"text-green-600"),children:[(0,a.jsx)("strong",{children:"Capacidad Restante:"})," ",O.toFixed(2)," kg"]})]}),o?(0,a.jsx)("p",{className:"text-center text-gray-500",children:"Cargando pedidos..."}):(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold",children:["Pedidos para ",g||"..."]}),S.length>0?S.map(e=>{let t=!!f[e.id_pedido_venta];return(0,a.jsxs)("div",{className:"p-3 rounded-lg shadow-sm border flex items-start gap-4 ".concat(!t&&O<(e.peso_total_kg||0)?"bg-gray-100 opacity-60":"bg-white"),children:[(0,a.jsx)("input",{type:"checkbox",checked:t,onChange:()=>((e,t)=>{if(!C){w({title:"Error",message:"Primero debe seleccionar un veh\xedculo.",isError:!0}),b(!0);return}let o=!!f[e];if(!o&&T+t>C.capacidad_kg){w({title:"Capacidad Excedida",message:"No se puede agregar este pedido, excede la capacidad del veh\xedculo.",isError:!0}),b(!0);return}x(t=>({...t,[e]:!o}))})(e.id_pedido_venta,e.peso_total_kg||0),disabled:!t&&O<(e.peso_total_kg||0),className:"mt-1 h-5 w-5"}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsxs)("p",{className:"font-bold",children:["Pedido #",e.id_pedido_venta," - ",e.razon_social]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.direccion_entrega}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("strong",{children:"Peso:"})," ",e.peso_total_kg||0," kg"]})]})]},e.id_pedido_venta)}):(0,a.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No hay pedidos para la zona seleccionada o seleccione una zona."})]}),(0,a.jsx)("button",{onClick:()=>{if(!C||!g||0===Object.keys(f).filter(e=>f[Number(e)]).length){w({title:"Datos incompletos",message:"Debe seleccionar un veh\xedculo, una zona y al menos un pedido.",isError:!0}),b(!0);return}j(!0)},disabled:N||!C||!g||0===Object.keys(f).filter(e=>f[Number(e)]).length,className:"w-full bg-primary text-white py-3 rounded-lg font-bold hover:bg-opacity-90 transition-opacity disabled:opacity-50",children:N?"Procesando...":"Finalizar Asignaci\xf3n"}),v&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Confirmar Asignaci\xf3n"}),(0,a.jsxs)("div",{className:"text-sm space-y-2 mb-6",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Veh\xedculo:"})," ",null==C?void 0:C.modelo]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Zona:"})," ",g]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Peso Total:"})," ",T.toFixed(2)," kg"]}),(0,a.jsxs)("p",{className:"font-bold",children:["Pedidos a asignar (",P.length,"):"]}),(0,a.jsx)("ul",{className:"list-disc list-inside max-h-40 overflow-y-auto",children:P.map(e=>(0,a.jsxs)("li",{children:["#",e.id_pedido_venta," - ",e.razon_social]},e.id_pedido_venta))})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>j(!1),className:"px-4 py-2 rounded-md bg-gray-200",children:"Cancelar"}),(0,a.jsx)("button",{onClick:z,className:"px-4 py-2 rounded-md bg-green-600 text-white",children:"Confirmar"})]})]})}),y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center border-t-4 ".concat(_.isError?"border-red-500":"border-green-500"),children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:_.title}),(0,a.jsx)("p",{className:"mb-6",children:_.message}),(0,a.jsx)("button",{onClick:()=>b(!1),className:"w-full px-4 py-2 rounded-md text-white ".concat(_.isError?"bg-red-600":"bg-green-600"),children:"Cerrar"})]})})]})]})}},51730:(e,t,o)=>{"use strict";o.d(t,{default:()=>s});var a=o(95155);o(12115);var r=o(20063),n=o(84926);let s=()=>{let e=(0,r.useRouter)();return(0,a.jsxs)("header",{className:"bg-gradient-primary text-white py-3 text-center relative flex items-center justify-center",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold",children:"CORE."}),(0,a.jsx)("h4",{children:"El N\xfacleo de tu Empresa"})]}),(0,a.jsxs)("button",{onClick:()=>{e.push("/")},className:"absolute top-1/2 right-4 -translate-y-1/2 flex items-center gap-2 px-3 py-1.5 text-sm font-semibold bg-white text-primary rounded-md hover:bg-gray-200 transition","aria-label":"Cerrar sesi\xf3n",children:[(0,a.jsx)(n.A,{size:16}),(0,a.jsx)("span",{children:"Salir"})]})]})}},62386:(e,t,o)=>{"use strict";o.d(t,{DW:()=>s,Lm:()=>r,wq:()=>n});let a="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function r(e){let t=await fetch("".concat(a,"/gestion-vehiculos/post-registrar-vehiculo"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Error al crear la flota");return t.json()}async function n(){let e=await fetch("".concat(a,"/gestion-vehiculos/get-vehiculos-disponibles"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching flotas");let t=await e.json();return Array.isArray(t.vehiculos)?t.vehiculos:[]}async function s(e){let t={id_vehiculo:e.id_vehiculo,ordenes_venta:e.ids_pedidos.map(e=>({id_orden_venta:e}))},o=await fetch("".concat(a,"/gestion-envios/post-crear-tanda-envios"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw Error((await o.json()).error||"Error al crear el envio");return o.json()}},71847:(e,t,o)=>{"use strict";o.d(t,{A:()=>d});var a=o(12115);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,o)=>o?o.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},n=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return t.filter((e,t,o)=>!!e&&""!==e.trim()&&o.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,a.forwardRef)((e,t)=>{let{color:o="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:d,className:c="",children:l,iconNode:h,...p}=e;return(0,a.createElement)("svg",{ref:t,...s,width:r,height:r,stroke:o,strokeWidth:d?24*Number(i)/Number(r):i,className:n("lucide",c),...!l&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(p)&&{"aria-hidden":"true"},...p},[...h.map(e=>{let[t,o]=e;return(0,a.createElement)(t,o)}),...Array.isArray(l)?l:[l]])}),d=(e,t)=>{let o=(0,a.forwardRef)((o,s)=>{let{className:d,...c}=o;return(0,a.createElement)(i,{ref:s,iconNode:t,className:n("lucide-".concat(r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),d),...c})});return o.displayName=r(e),o}},84926:(e,t,o)=>{"use strict";o.d(t,{A:()=>a});let a=(0,o(71847).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=20154)),_N_E=e.O()}]);