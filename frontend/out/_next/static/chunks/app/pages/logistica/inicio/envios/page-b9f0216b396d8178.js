(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[260],{20154:(e,t,o)=>{Promise.resolve().then(o.bind(o,29625))},28569:(e,t,o)=>{"use strict";o.d(t,{$1:()=>l,A1:()=>m,LP:()=>h,NV:()=>s,OV:()=>i,Ob:()=>f,Sr:()=>p,UE:()=>g,X6:()=>n,dC:()=>d,gq:()=>u,lm:()=>r,s1:()=>c});let a="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function n(){let e=await fetch("".concat(a,"/crear-orden-venta"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching productos");let t=await e.json();return console.log(t),t.data}async function r(e){console.log("Creando nuevo pedido con data:",e);let t=await fetch("".concat(a,"/crear-orden-venta"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(console.log(JSON.stringify(e)),!t.ok){let e=await t.json();throw Error("Error creating pedido: ".concat(t.status," - ").concat(JSON.stringify(e)))}return t.json()}async function s(){let e=await fetch("".concat(a,"/get-orden-venta"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching solicitudes de venta");return(await e.json()).orden_ventas_pendientes}async function i(e,t){let o=await fetch("".concat(a,"/crear-orden-venta/update-estado-orden-venta"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_pedido:e,estado:t})});if(!o.ok){let e=await o.json();throw Error("Error updating estado: ".concat(o.status," - ").concat(JSON.stringify(e)))}return o.json()}async function d(){let e=await fetch("".concat(a,"/get-orden-venta/get-orden-venta-lista-con-envio"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching pedidos terminados");let t=await e.json();return console.log("Pedidos Terminados Data:",t.pedidos),t.pedidos}async function c(e){let t=await fetch("".concat(a,"/gestion-envios/post-get-envios-por-estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({estado:e})});if(!t.ok)throw Error("Error fetching pedidos asignados");let o=await t.json();return console.log("Response Data:",o),o.vehiculos}async function l(e){let t=await fetch("".concat(a,"/gestion-envios/post-update-despachar-all-envios-de-vehiculo"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_vehiculo:e})});if(!t.ok){let e=await t.json();throw Error("Error updating estado envio: ".concat(t.status," - ").concat(JSON.stringify(e)))}return t.json()}async function p(e,t){let o={id_envio:e,estado:t};console.log(JSON.stringify(o));let n=await fetch("".concat(a,"/gestion-envios/post-update-estado-envio"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!n.ok){let e=await n.json();throw Error("Error updating estado envio: ".concat(n.status," - ").concat(JSON.stringify(e)))}return n.json()}async function h(){let e=await fetch("".concat(a,"/crear-orden-venta/get-orden-venta-atrasada"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw console.error("Failed to fetch pedidos reprogramados:",e.statusText),Error("Error fetching pedidos reprogramados");return await e.json()}async function u(){let e=await fetch("".concat(a,"/get-orden-venta/get-orden-venta-en-supervision-por-urgencia"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error fetching pedidos urgentes");return(await e.json()).orden_ventas_pendiente_supervision_urgencia}async function g(e){let t={id_orden_venta:e};console.log(JSON.stringify(t));let o=await fetch("".concat(a,"/get-orden-venta/planificador_ordenes_produccion_simulacion_ov"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw Error("Error fetching ordenes que se retrasan");return(await o.json()).ordenes_afectadas}async function m(e,t){let o=await fetch("".concat(a,"/get-orden-venta/get-detalle-pedido-por-id-y-cuil"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_orden_venta:t,cuil:e})}),n=await o.json();if(!o.ok)throw Error(n.error||"Error fetching estado del pedido");return n}async function f(e,t,o,n,r){let s=await fetch("".concat(a,"/crear-direccion/post-obtener-direcciones-normalizadas"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_cliente:r,calle:e,numero:t,localidad:o,provincia:n})});if(!s.ok){let e=await s.json();throw Error("Error creating direccion: ".concat(s.status," - ").concat(JSON.stringify(e)))}let i=await s.json();return console.log("Respuesta de crearDireccion en API:",i),i}},29625:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>c});var a=o(95155),n=o(51730),r=o(12115),s=o(62386),i=o(28569);let d=(0,o(67909).default)(()=>Promise.all([o.e(4804),o.e(1761),o.e(6562)]).then(o.bind(o,16562)),{loadableGenerated:{webpack:()=>[16562]},ssr:!1}),c=()=>{let[e,t]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[l,p]=(0,r.useState)([]),[h,u]=(0,r.useState)(null),[g,m]=(0,r.useState)({}),[f,x]=(0,r.useState)(!1),[j,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)({title:"",message:"",isError:!1}),[w,N]=(0,r.useState)(!1),[_,E]=(0,r.useState)(!1),k=async()=>{c(!0);try{let e=await (0,i.dC)();t(e);let o=await (0,s.wq)();p(o)}catch(e){console.error("Error al cargar datos:",e),v({title:"Error",message:"No se pudieron cargar los datos. Intente de nuevo.",isError:!0}),b(!0)}finally{c(!1)}};(0,r.useEffect)(()=>{k()},[]);let S=r.useMemo(()=>l.find(e=>e.id===h)||null,[h,l]),C=r.useMemo(()=>e,[e]),O=r.useMemo(()=>C.reduce((e,t)=>g[t.id_pedido_venta]?e+(Number(t.peso_total_kg)||0):e,0),[g,C]),T=S?(Number(S.capacidad_kg)||0)-O:0,P=async()=>{if(!S)return;N(!0),x(!1);let e=Object.keys(g).filter(e=>!0===g[Number(e)]).map(Number);console.log("Asignando env\xedo con datos:",{id_vehiculo:S.id,ids_pedidos:e});try{await (0,s.DW)({id_vehiculo:S.id,ids_pedidos:e}),v({title:"\xc9xito",message:"El env\xedo se ha asignado correctamente.",isError:!1}),u(null),m({}),await k()}catch(e){console.error("Error al crear env\xedo:",e),v({title:"Error",message:"Hubo un problema al asignar el env\xedo. Por favor, intente de nuevo.",isError:!0})}finally{N(!1),b(!0)}},J=r.useMemo(()=>e.filter(e=>g[e.id_pedido_venta]),[e,g]);return(0,a.jsxs)("div",{children:[(0,a.jsx)(n.default,{}),(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold  text-center",children:"Gesti\xf3n de Env\xedos"}),(0,a.jsx)("button",{onClick:()=>E(!0),className:"bg-primary rounded p-3 w-full text-white",children:"Ver Mapa"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"flota",className:"block text-sm font-medium text-gray-700 mb-1",children:"Seleccionar Flota"}),(0,a.jsxs)("select",{id:"flota",value:null!=h?h:"",onChange:e=>{u(Number(e.target.value)),m({})},className:"w-full p-2 border rounded-md bg-white shadow-sm",children:[(0,a.jsx)("option",{value:"",disabled:!0,children:"-- Seleccione un veh\xedculo --"}),l.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.nombre_conductor," - ",e.modelo," (Cap: ",e.capacidad_kg," kg)"]},e.id))]})]})}),S&&(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg text-sm",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Veh\xedculo:"})," ",S.modelo]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Capacidad Total:"})," ",S.capacidad_kg," kg"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Peso Seleccionado:"})," ",O.toFixed(2)," kg"]}),(0,a.jsxs)("p",{className:"font-bold ".concat(T<0?"text-red-600":"text-green-600"),children:[(0,a.jsx)("strong",{children:"Capacidad Restante:"})," ",T.toFixed(2)," kg"]})]}),o?(0,a.jsx)("p",{className:"text-center text-gray-500",children:"Cargando pedidos..."}):(0,a.jsx)("div",{className:"space-y-3",children:C.length>0?C.map(e=>{let t=!!g[e.id_pedido_venta],o=Number(e.peso_total_kg)||0;return(0,a.jsxs)("div",{className:"p-3 rounded-lg shadow-sm border flex items-start gap-4 ".concat(!t&&T<(e.peso_total_kg||0)?"bg-gray-100 opacity-60":"bg-white"),children:[(0,a.jsx)("input",{type:"checkbox",checked:t,onChange:()=>((e,t)=>{if(!S){v({title:"Error",message:"Primero debe seleccionar un veh\xedculo.",isError:!0}),b(!0);return}let o=!!g[e];if(!o&&O+t>S.capacidad_kg){v({title:"Capacidad Excedida",message:"No se puede agregar este pedido, excede la capacidad del veh\xedculo.",isError:!0}),b(!0);return}m(t=>({...t,[e]:!o}))})(e.id_pedido_venta,o),disabled:!t&&T<o,className:"mt-1 h-5 w-5"}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsxs)("p",{className:"font-bold",children:["Pedido #",e.id_pedido_venta," - ",e.razon_social]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.direccion_text}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("strong",{children:"Peso:"})," ",o," kg"]})]})]},e.id_pedido_venta)}):(0,a.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No hay pedidos disponibles."})}),(0,a.jsx)("button",{onClick:()=>{if(!S||0===Object.keys(g).filter(e=>g[Number(e)]).length){v({title:"Datos incompletos",message:"Debe seleccionar un veh\xedculo y al menos un pedido.",isError:!0}),b(!0);return}x(!0)},disabled:w||!S||0===Object.keys(g).filter(e=>g[Number(e)]).length,className:"w-full bg-primary text-white py-3 rounded-lg font-bold hover:bg-opacity-90 transition-opacity disabled:opacity-50",children:w?"Procesando...":"Finalizar Asignaci\xf3n"}),f&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Confirmar Asignaci\xf3n"}),(0,a.jsxs)("div",{className:"text-sm space-y-2 mb-6",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Veh\xedculo:"})," ",null==S?void 0:S.modelo]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Peso Total:"})," ",O.toFixed(2)," kg"]}),(0,a.jsxs)("p",{className:"font-bold",children:["Pedidos a asignar (",J.length,"):"]}),(0,a.jsx)("ul",{className:"list-disc list-inside max-h-40 overflow-y-auto",children:J.map(e=>(0,a.jsxs)("li",{children:["#",e.id_pedido_venta," - ",e.razon_social]},e.id_pedido_venta))})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>x(!1),className:"px-4 py-2 rounded-md bg-gray-200",children:"Cancelar"}),(0,a.jsx)("button",{onClick:P,className:"px-4 py-2 rounded-md bg-green-600 text-white",children:"Confirmar"})]})]})}),j&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center border-t-4 ".concat(y.isError?"border-red-500":"border-green-500"),children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:y.title}),(0,a.jsx)("p",{className:"mb-6",children:y.message}),(0,a.jsx)("button",{onClick:()=>b(!1),className:"w-full px-4 py-2 rounded-md text-white ".concat(y.isError?"bg-red-600":"bg-green-600"),children:"Cerrar"})]})}),_&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 w-full max-w-4xl h-[80vh]",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold",children:"Mapa de Env\xedos"}),(0,a.jsx)("button",{onClick:()=>E(!1),className:"px-4 py-2 rounded-md bg-red-600 text-white",children:"Cerrar"})]}),(0,a.jsx)("div",{className:"h-full",children:(0,a.jsx)(d,{pedidos:e})})]})})]})]})}}},e=>{e.O(0,[1356,8811,8441,1255,7358],()=>e(e.s=20154)),_N_E=e.O()}]);