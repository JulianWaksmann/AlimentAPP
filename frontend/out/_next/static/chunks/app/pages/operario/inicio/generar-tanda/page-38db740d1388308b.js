(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2425],{1829:(e,a,r)=>{Promise.resolve().then(r.bind(r,38846))},15239:(e,a,r)=>{"use strict";r.d(a,{default:()=>n.a});var t=r(54652),n=r.n(t)},20063:(e,a,r)=>{"use strict";var t=r(47260);r.o(t,"usePathname")&&r.d(a,{usePathname:function(){return t.usePathname}}),r.o(t,"useRouter")&&r.d(a,{useRouter:function(){return t.useRouter}})},38846:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>c});var t=r(95155),n=r(12115),i=r(96440);function s(e){var a,r,s,o,c;let{lineas:l,onUpdated:u}=e,[m,p]=(0,n.useState)(null!=l?l:[]),[x,h]=(0,n.useState)(null!=(r=null==l||null==(a=l[0])?void 0:a.id_linea_produccion)?r:null),[_,g]=(0,n.useState)({}),[f,j]=(0,n.useState)(!1),[v,b]=(0,n.useState)(null),[N,y]=(0,n.useState)(!1);(0,n.useEffect)(()=>{if(l&&l.length)return;let e=!0;return(async()=>{try{let a=await (0,i.N0)();if(!e)return;p(a),a.length&&h(a[0].id_linea_produccion)}catch(e){console.error(e),b({title:"Error",body:"No se pudieron cargar las l\xedneas. Reintenta."})}})(),()=>{e=!1}},[l]);let w=(0,n.useMemo)(()=>{var e;return null!=(e=m.find(e=>e.id_linea_produccion===x))?e:null},[m,x]),E=(0,n.useMemo)(()=>{var e;return w?(null!=(e=w.ordenes_de_produccion_aceptadas)?e:[]).reduce((e,a)=>_[a.id_orden_produccion]?e+(Number(a.cantidad_kg_orden_produccion)||0):e,0):0},[_,w]),k=w&&Number(w.capacidad_linea_produccion)||0,C=Math.max(0,k-E),S=async()=>{var e;if(j(!1),!w||null===x)return void b({title:"Error",body:"No hay l\xednea seleccionada."});let a=(null!=(e=w.ordenes_de_produccion_aceptadas)?e:[]).filter(e=>_[e.id_orden_produccion]);if(0===a.length)return void b({title:"Error",body:"No se encontraron \xf3rdenes seleccionadas."});let r={id_linea_produccion:x,ordenes_produccion:a.map(e=>{var a,r;return{id_orden_produccion:e.id_orden_produccion,cantidad_kg:Number(null!=(r=null!=(a=e.cantidad_kg_orden_produccion)?a:e.cantidad_kg)?r:0)}})};y(!0);try{await (0,i.sI)(r),b({title:"\xc9xito",body:"Tanda generada y puesta en producci\xf3n."}),p(e=>e.map(e=>{var a;return e.id_linea_produccion!==x?e:{...e,ordenes_de_produccion_aceptadas:(null!=(a=e.ordenes_de_produccion_aceptadas)?a:[]).filter(e=>!_[e.id_orden_produccion])}})),g({}),null==u||u()}catch(e){console.error(e),b({title:"Error",body:"Ocurri\xf3 un error al generar la tanda. Reintenta."})}finally{y(!1)}};return(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block text-sm text-gray-700 mb-1",children:"Seleccionar l\xednea de producci\xf3n"}),(0,t.jsxs)("select",{value:null!=x?x:"",onChange:e=>{h(Number(e.target.value)),g({})},className:"w-full p-2 border rounded-md bg-white",children:[(0,t.jsx)("option",{value:"",disabled:!0,children:"-- Seleccionar l\xednea --"}),m.map(e=>(0,t.jsxs)("option",{value:e.id_linea_produccion,children:[e.nombre_linea_produccion," — ",e.capacidad_linea_produccion," kg"]},e.id_linea_produccion))]})]}),w?(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-white shadow-sm border",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:w.nombre_linea_produccion}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:w.descripcion_linea_produccion})]}),(0,t.jsxs)("div",{className:"text-right text-sm",children:[(0,t.jsxs)("div",{className:"font-semibold",children:[k," kg"]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Capacidad"})]})]}),(0,t.jsxs)("div",{className:"mt-2 text-sm",children:[(0,t.jsxs)("div",{children:["Seleccionados: ",Object.values(_).filter(Boolean).length," orden(es)"]}),(0,t.jsxs)("div",{children:["Total kg: ",(0,t.jsxs)("span",{className:"font-semibold",children:[E," kg"]})," — Restante: ",(0,t.jsxs)("span",{className:"".concat(0===C?"text-red-600":"text-gray-700"),children:[C," kg"]})]})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,t.jsx)("button",{onClick:()=>Object.values(_).filter(Boolean).length?E<1?void b({title:"Kg inv\xe1lidos",body:"La cantidad total seleccionada debe ser mayor a 0 kg."}):void j(!0):void b({title:"Selecci\xf3n vac\xeda",body:"Deb\xe9s seleccionar al menos una orden para generar la tanda."}),disabled:N,className:"flex-1 px-4 py-2 bg-success text-white rounded-md shadow-sm disabled:opacity-60",children:N?"Procesando...":"Generar Tanda"}),(0,t.jsx)("button",{onClick:()=>{g({})},className:"px-4 py-2 bg-error rounded-md",children:"Limpiar"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(null!=(s=w.ordenes_de_produccion_aceptadas)?s:[]).map(e=>{let a=Number(e.cantidad_kg_orden_produccion)||0,r=!_[e.id_orden_produccion]&&E+a>k;return(0,t.jsx)("div",{className:"bg-white rounded-md p-3 shadow-sm border",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:e.nombre_producto}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[e.nombre_cliente," ",e.apellido_cliente]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("div",{className:"font-semibold",children:[a," kg"]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Orden: #",e.id_orden_produccion]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:["Cantidad Bultos: ",e.cantidad_producto]})]})]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[(0,t.jsxs)("div",{children:["Creada: ",e.fecha_creacion_orden_venta]}),(0,t.jsxs)("div",{children:["Entrega solicitada: ",e.fecha_entrega_solicitada_orden_venta]})]}),e.materias_primas_requeridas&&e.materias_primas_requeridas.length>0&&(0,t.jsxs)("details",{className:"mt-2",children:[(0,t.jsxs)("summary",{className:"text-sm text-primary cursor-pointer",children:["Materias primas (",e.materias_primas_requeridas.length,")"]}),(0,t.jsx)("div",{className:"mt-2 space-y-1 text-sm text-gray-700",children:(e.materias_primas_requeridas||[]).map(e=>{var a;return(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("div",{children:[e.nombre_materia_prima," - ",e.codigo_lote]}),(0,t.jsxs)("div",{className:"text-xs text-gray-600",children:[e.cantidad_materia_prima," ",e.unidad_medida_materia_prima]})]},null!=(a=e.id_lote_materia_prima)?a:e.codigo_lote)})})]})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:!!_[e.id_orden_produccion],onChange:()=>((e,a)=>{let r=!!_[e];if(!r&&E+a>k)return void b({title:"Capacidad excedida",body:"No pod\xe9s seleccionar esa orden: superar\xeda la capacidad m\xe1xima de la l\xednea."});g(a=>({...a,[e]:!r}))})(e.id_orden_produccion,a),disabled:r,className:"w-5 h-5","aria-label":"Seleccionar orden ".concat(e.id_orden_produccion)}),r&&(0,t.jsx)("div",{className:"text-xs text-red-600",children:"Excede"})]})]})},e.id_orden_produccion)}),0===(null!=(o=w.ordenes_de_produccion_aceptadas)?o:[]).length&&(0,t.jsx)("div",{className:"text-sm text-gray-500 p-3",children:"No hay \xf3rdenes compatibles disponibles."})]})]}):(0,t.jsx)("div",{className:"text-center text-sm text-gray-500",children:"Seleccion\xe1 una l\xednea para ver \xf3rdenes."}),(0,t.jsxs)(d,{visible:f,onClose:()=>j(!1),title:"Confirmaci\xf3n",children:[(0,t.jsx)("p",{className:"text-sm",children:"ESTA TANDA GENERADA MANUALMENTE PUEDE NO SER LA ELECCI\xd3N M\xc1S \xd3PTIMA PARA LA PLANIFICACI\xd3N, \xbfEST\xc1 SEGURO DE QUERER PONER EN PROCESO ESTA TANDA?"}),(0,t.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,t.jsx)("button",{onClick:S,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md",children:"S\xed, confirmar"}),(0,t.jsx)("button",{onClick:()=>j(!1),className:"px-4 py-2 bg-gray-100 rounded-md",children:"Cancelar"})]})]}),(0,t.jsxs)(d,{visible:!!v,onClose:()=>b(null),title:null!=(c=null==v?void 0:v.title)?c:"",children:[(0,t.jsx)("p",{className:"text-sm",children:null==v?void 0:v.body}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)("button",{onClick:()=>b(null),className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Cerrar"})})]})]})}let d=e=>{let{visible:a,onClose:r,title:n,children:i}=e;return a?(0,t.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold mb-4",children:n}),(0,t.jsx)("div",{children:i}),(0,t.jsx)("button",{onClick:r,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded",children:"Cerrar"})]})}):null};var o=r(51730);let c=()=>(0,t.jsxs)("div",{children:[(0,t.jsx)(o.default,{}),(0,t.jsx)("h1",{className:"text-xxl font-bold text-center my-3",children:"Generar Tanda de Producci\xf3n Manualmente"}),(0,t.jsx)("div",{children:(0,t.jsx)(s,{})})]})},51730:(e,a,r)=>{"use strict";r.d(a,{default:()=>d});var t=r(95155);r(12115);var n=r(20063),i=r(84926),s=r(15239);let d=()=>{let e=(0,n.useRouter)();return(0,t.jsxs)("header",{className:"relative flex items-center justify-center py-3 text-center text-white",children:[(0,t.jsx)(s.default,{src:"/Banner.jpg",alt:"Banner",fill:!0,priority:!0,className:"object-cover "}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-4xl font-bold",children:"CORE."}),(0,t.jsx)("h4",{children:"El N\xfacleo de tu Empresa"})]}),(0,t.jsxs)("button",{onClick:()=>{e.push("/")},className:"absolute top-1/2 right-4 -translate-y-1/2 flex items-center gap-2 px-3 py-1.5 text-sm font-semibold bg-white text-primary rounded-md hover:bg-gray-200 transition","aria-label":"Cerrar sesi\xf3n",children:[(0,t.jsx)(i.A,{size:16}),(0,t.jsx)("span",{})]})]})}},54652:(e,a,r)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),!function(e,a){for(var r in a)Object.defineProperty(e,r,{enumerable:!0,get:a[r]})}(a,{default:function(){return o},getImageProps:function(){return d}});let t=r(28140),n=r(75040),i=r(81356),s=t._(r(71124));function d(e){let{props:a}=(0,n.getImgProps)(e,{defaultLoader:s.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image/",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,r]of Object.entries(a))void 0===r&&delete a[e];return{props:a}}let o=i.Image},71847:(e,a,r)=>{"use strict";r.d(a,{A:()=>o});var t=r(12115);let n=e=>{let a=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,a,r)=>r?r.toUpperCase():a.toLowerCase());return a.charAt(0).toUpperCase()+a.slice(1)},i=function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return a.filter((e,a,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===a).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let d=(0,t.forwardRef)((e,a)=>{let{color:r="currentColor",size:n=24,strokeWidth:d=2,absoluteStrokeWidth:o,className:c="",children:l,iconNode:u,...m}=e;return(0,t.createElement)("svg",{ref:a,...s,width:n,height:n,stroke:r,strokeWidth:o?24*Number(d)/Number(n):d,className:i("lucide",c),...!l&&!(e=>{for(let a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[a,r]=e;return(0,t.createElement)(a,r)}),...Array.isArray(l)?l:[l]])}),o=(e,a)=>{let r=(0,t.forwardRef)((r,s)=>{let{className:o,...c}=r;return(0,t.createElement)(d,{ref:s,iconNode:a,className:i("lucide-".concat(n(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),o),...c})});return r.displayName=n(e),r}},84926:(e,a,r)=>{"use strict";r.d(a,{A:()=>t});let t=(0,r(71847).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])},96440:(e,a,r)=>{"use strict";r.d(a,{Ec:()=>n,N0:()=>s,sI:()=>d,tv:()=>o,w_:()=>i});let t="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function n(e){let a=await fetch("".concat(t,"/tanda-produccion/post-obtener-tanda-produccion-por-estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({estado:e})});if(!a.ok)throw Error("Error fetching tandas sugeridas");let r=await a.json();return console.log(r),r.lineas_produccion}async function i(e,a){let r={id_tandas:e,estado:a};if(console.log(r),console.log("actualizar ot "+e+" a estado: "+a),!(await fetch("".concat(t,"/tanda-produccion/post-update-tandas-produccion-estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw Error("Error updating tanda produccion")}async function s(){let e=await fetch("".concat(t,"/tanda-produccion/get-all-ordenes-produccion-aceptadas-por-linea-produccion"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error generating tanda");let a=await e.json();return console.log(a),a.lineas_produccion}async function d(e){console.log("Crear Tanda Produccion Manual: ",JSON.stringify({id_linea_produccion:e.id_linea_produccion,ordenes_produccion:e.ordenes_produccion}));let a=await fetch("".concat(t,"/tanda-produccion/post-crear-tandas-produccion-manual"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e=await a.json();throw console.log("Error creating tanda produccion manual:",e),Error(e.error||"Error creating tanda produccion manual")}return a.json()}async function o(){try{let e=await fetch("".concat(t,"/orden-produccion/planificador_op_daily"),{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok){let a=await e.json();throw Error(a.error||"Error fetching planificacion data")}return await e.json()}catch(e){throw console.log("error general: "+e),e}}}},e=>{e.O(0,[1356,8441,1255,7358],()=>e(e.s=1829)),_N_E=e.O()}]);