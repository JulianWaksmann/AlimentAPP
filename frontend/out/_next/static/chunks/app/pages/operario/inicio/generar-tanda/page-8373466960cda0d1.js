(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2425],{1829:(e,a,r)=>{Promise.resolve().then(r.bind(r,38846))},20063:(e,a,r)=>{"use strict";var s=r(47260);r.o(s,"usePathname")&&r.d(a,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(a,{useRouter:function(){return s.useRouter}})},38846:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>c});var s=r(95155),i=r(12115),t=r(96440);function d(e){var a,r,d,l,c;let{lineas:o,onUpdated:u}=e,[m,x]=(0,i.useState)(null!=o?o:[]),[p,h]=(0,i.useState)(null!=(r=null==o||null==(a=o[0])?void 0:a.id_linea_produccion)?r:null),[_,v]=(0,i.useState)({}),[N,b]=(0,i.useState)(!1),[j,g]=(0,i.useState)(null),[f,y]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(o&&o.length)return;let e=!0;return(async()=>{try{let a=await (0,t.N0)();if(!e)return;x(a),a.length&&h(a[0].id_linea_produccion)}catch(e){console.error(e),g({title:"Error",body:"No se pudieron cargar las l\xedneas. Reintenta."})}})(),()=>{e=!1}},[o]);let k=(0,i.useMemo)(()=>{var e;return null!=(e=m.find(e=>e.id_linea_produccion===p))?e:null},[m,p]),w=(0,i.useMemo)(()=>{var e;return k?(null!=(e=k.ordenes_de_produccion_aceptadas)?e:[]).reduce((e,a)=>_[a.id_orden_produccion]?e+(Number(a.cantidad_kg_orden_produccion)||0):e,0):0},[_,k]),E=k&&Number(k.capacidad_linea_produccion)||0,C=Math.max(0,E-w),A=async()=>{var e;if(b(!1),!k||null===p)return void g({title:"Error",body:"No hay l\xednea seleccionada."});let a=(null!=(e=k.ordenes_de_produccion_aceptadas)?e:[]).filter(e=>_[e.id_orden_produccion]);if(0===a.length)return void g({title:"Error",body:"No se encontraron \xf3rdenes seleccionadas."});let r={id_linea_produccion:p,ordenes_produccion:a.map(e=>{var a,r;return{id_orden_produccion:e.id_orden_produccion,cantidad_kg:Number(null!=(r=null!=(a=e.cantidad_kg_orden_produccion)?a:e.cantidad_kg)?r:0)}})};y(!0);try{await (0,t.sI)(r),g({title:"\xc9xito",body:"Tanda generada y puesta en producci\xf3n."}),x(e=>e.map(e=>{var a;return e.id_linea_produccion!==p?e:{...e,ordenes_de_produccion_aceptadas:(null!=(a=e.ordenes_de_produccion_aceptadas)?a:[]).filter(e=>!_[e.id_orden_produccion])}})),v({}),null==u||u()}catch(e){console.error(e),g({title:"Error",body:"Ocurri\xf3 un error al generar la tanda. Reintenta."})}finally{y(!1)}};return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm text-gray-700 mb-1",children:"Seleccionar l\xednea de producci\xf3n"}),(0,s.jsxs)("select",{value:null!=p?p:"",onChange:e=>{h(Number(e.target.value)),v({})},className:"w-full p-2 border rounded-md bg-white",children:[(0,s.jsx)("option",{value:"",disabled:!0,children:"-- Seleccionar l\xednea --"}),m.map(e=>(0,s.jsxs)("option",{value:e.id_linea_produccion,children:[e.nombre_linea_produccion," — ",e.capacidad_linea_produccion," kg"]},e.id_linea_produccion))]})]}),k?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-white shadow-sm border",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:k.nombre_linea_produccion}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:k.descripcion_linea_produccion})]}),(0,s.jsxs)("div",{className:"text-right text-sm",children:[(0,s.jsxs)("div",{className:"font-semibold",children:[E," kg"]}),(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Capacidad"})]})]}),(0,s.jsxs)("div",{className:"mt-2 text-sm",children:[(0,s.jsxs)("div",{children:["Seleccionados: ",Object.values(_).filter(Boolean).length," orden(es)"]}),(0,s.jsxs)("div",{children:["Total kg: ",(0,s.jsxs)("span",{className:"font-semibold",children:[w," kg"]})," — Restante: ",(0,s.jsxs)("span",{className:"".concat(0===C?"text-red-600":"text-gray-700"),children:[C," kg"]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(null!=(d=k.ordenes_de_produccion_aceptadas)?d:[]).map(e=>{let a=Number(e.cantidad_kg_orden_produccion)||0,r=!_[e.id_orden_produccion]&&w+a>E;return(0,s.jsx)("div",{className:"bg-white rounded-md p-3 shadow-sm border",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:e.nombre_producto}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[e.nombre_cliente," ",e.apellido_cliente]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"font-semibold",children:[a," kg"]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["Orden: #",e.id_orden_produccion]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["Cantidad Bultos: ",e.cantidad_producto]})]})]}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[(0,s.jsxs)("div",{children:["Creada: ",e.fecha_creacion_orden_venta]}),(0,s.jsxs)("div",{children:["Entrega solicitada: ",e.fecha_entrega_solicitada_orden_venta]})]}),e.materias_primas_requeridas&&e.materias_primas_requeridas.length>0&&(0,s.jsxs)("details",{className:"mt-2",children:[(0,s.jsxs)("summary",{className:"text-sm text-primary cursor-pointer",children:["Materias primas (",e.materias_primas_requeridas.length,")"]}),(0,s.jsx)("div",{className:"mt-2 space-y-1 text-sm text-gray-700",children:(e.materias_primas_requeridas||[]).map(e=>{var a;return(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("div",{children:[e.nombre_materia_prima," - ",e.codigo_lote]}),(0,s.jsxs)("div",{className:"text-xs text-gray-600",children:[e.cantidad_materia_prima," ",e.unidad_medida_materia_prima]})]},null!=(a=e.id_lote_materia_prima)?a:e.codigo_lote)})})]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:!!_[e.id_orden_produccion],onChange:()=>((e,a)=>{let r=!!_[e];if(!r&&w+a>E)return void g({title:"Capacidad excedida",body:"No pod\xe9s seleccionar esa orden: superar\xeda la capacidad m\xe1xima de la l\xednea."});v(a=>({...a,[e]:!r}))})(e.id_orden_produccion,a),disabled:r,className:"w-5 h-5","aria-label":"Seleccionar orden ".concat(e.id_orden_produccion)}),r&&(0,s.jsx)("div",{className:"text-xs text-red-600",children:"Excede"})]})]})},e.id_orden_produccion)}),0===(null!=(l=k.ordenes_de_produccion_aceptadas)?l:[]).length&&(0,s.jsx)("div",{className:"text-sm text-gray-500 p-3",children:"No hay \xf3rdenes compatibles disponibles."})]}),(0,s.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,s.jsx)("button",{onClick:()=>Object.values(_).filter(Boolean).length?w<1?void g({title:"Kg inv\xe1lidos",body:"La cantidad total seleccionada debe ser mayor a 0 kg."}):void b(!0):void g({title:"Selecci\xf3n vac\xeda",body:"Deb\xe9s seleccionar al menos una orden para generar la tanda."}),disabled:f,className:"flex-1 px-4 py-2 bg-amber-600 text-white rounded-md shadow-sm disabled:opacity-60",children:f?"Procesando...":"Generar Tanda"}),(0,s.jsx)("button",{onClick:()=>{v({})},className:"px-4 py-2 bg-gray-100 rounded-md",children:"Limpiar"})]})]}):(0,s.jsx)("div",{className:"text-center text-sm text-gray-500",children:"Seleccion\xe1 una l\xednea para ver \xf3rdenes."}),(0,s.jsxs)(n,{visible:N,onClose:()=>b(!1),title:"Confirmaci\xf3n",children:[(0,s.jsx)("p",{className:"text-sm",children:"ESTA TANDA GENERADA MANUALMENTE PUEDE NO SER LA ELECCI\xd3N M\xc1S \xd3PTIMA PARA LA PLANIFICACI\xd3N, \xbfEST\xc1 SEGURO DE QUERER PONER EN PROCESO ESTA TANDA?"}),(0,s.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,s.jsx)("button",{onClick:A,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md",children:"S\xed, confirmar"}),(0,s.jsx)("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-gray-100 rounded-md",children:"Cancelar"})]})]}),(0,s.jsxs)(n,{visible:!!j,onClose:()=>g(null),title:null!=(c=null==j?void 0:j.title)?c:"",children:[(0,s.jsx)("p",{className:"text-sm",children:null==j?void 0:j.body}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("button",{onClick:()=>g(null),className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Cerrar"})})]})]})}let n=e=>{let{visible:a,onClose:r,title:i,children:t}=e;return a?(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-4",children:i}),(0,s.jsx)("div",{children:t}),(0,s.jsx)("button",{onClick:r,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded",children:"Cerrar"})]})}):null};var l=r(51730);let c=()=>(0,s.jsxs)("div",{children:[(0,s.jsx)(l.default,{}),(0,s.jsx)("h1",{className:"text-xxl font-bold text-center my-3",children:"Generar Tanda de Producci\xf3n Manualmente"}),(0,s.jsx)("div",{children:(0,s.jsx)(d,{})})]})},71847:(e,a,r)=>{"use strict";r.d(a,{A:()=>l});var s=r(12115);let i=e=>{let a=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,a,r)=>r?r.toUpperCase():a.toLowerCase());return a.charAt(0).toUpperCase()+a.slice(1)},t=function(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return a.filter((e,a,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===a).join(" ").trim()};var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,s.forwardRef)((e,a)=>{let{color:r="currentColor",size:i=24,strokeWidth:n=2,absoluteStrokeWidth:l,className:c="",children:o,iconNode:u,...m}=e;return(0,s.createElement)("svg",{ref:a,...d,width:i,height:i,stroke:r,strokeWidth:l?24*Number(n)/Number(i):n,className:t("lucide",c),...!o&&!(e=>{for(let a in e)if(a.startsWith("aria-")||"role"===a||"title"===a)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[a,r]=e;return(0,s.createElement)(a,r)}),...Array.isArray(o)?o:[o]])}),l=(e,a)=>{let r=(0,s.forwardRef)((r,d)=>{let{className:l,...c}=r;return(0,s.createElement)(n,{ref:d,iconNode:a,className:t("lucide-".concat(i(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),l),...c})});return r.displayName=i(e),r}},84926:(e,a,r)=>{"use strict";r.d(a,{A:()=>s});let s=(0,r(71847).A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])}},e=>{e.O(0,[1841,8441,1255,7358],()=>e(e.s=1829)),_N_E=e.O()}]);