(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2425],{1829:(e,a,n)=>{Promise.resolve().then(n.bind(n,38846))},38846:(e,a,n)=>{"use strict";n.r(a),n.d(a,{default:()=>o});var r=n(95155),d=n(12115),s=n(96440);function i(e){var a,n,i,c,o;let{lineas:l,onUpdated:u}=e,[m,p]=(0,d.useState)(null!=l?l:[]),[x,h]=(0,d.useState)(null!=(n=null==l||null==(a=l[0])?void 0:a.id_linea_produccion)?n:null),[_,g]=(0,d.useState)({}),[j,N]=(0,d.useState)(!1),[b,v]=(0,d.useState)(null),[y,f]=(0,d.useState)(!1);(0,d.useEffect)(()=>{if(l&&l.length)return;let e=!0;return(async()=>{try{let a=await (0,s.N0)();if(!e)return;p(a),a.length&&h(a[0].id_linea_produccion)}catch(e){console.error(e),v({title:"Error",body:"No se pudieron cargar las l\xedneas. Reintenta."})}})(),()=>{e=!1}},[l]);let E=(0,d.useMemo)(()=>{var e;return null!=(e=m.find(e=>e.id_linea_produccion===x))?e:null},[m,x]),w=(0,d.useMemo)(()=>{var e;return E?(null!=(e=E.ordenes_de_produccion_aceptadas)?e:[]).reduce((e,a)=>_[a.id_orden_produccion]?e+(Number(a.cantidad_kg_orden_produccion)||0):e,0):0},[_,E]),C=E&&Number(E.capacidad_linea_produccion)||0,k=Math.max(0,C-w),S=async()=>{var e;if(N(!1),!E||null===x)return void v({title:"Error",body:"No hay l\xednea seleccionada."});let a=(null!=(e=E.ordenes_de_produccion_aceptadas)?e:[]).filter(e=>_[e.id_orden_produccion]);if(0===a.length)return void v({title:"Error",body:"No se encontraron \xf3rdenes seleccionadas."});let n={id_linea_produccion:x,ordenes_produccion:a.map(e=>{var a,n;return{id_orden_produccion:e.id_orden_produccion,cantidad_kg:Number(null!=(n=null!=(a=e.cantidad_kg_orden_produccion)?a:e.cantidad_kg)?n:0)}})};f(!0);try{await (0,s.sI)(n),v({title:"\xc9xito",body:"Tanda generada y puesta en producci\xf3n."}),p(e=>e.map(e=>{var a;return e.id_linea_produccion!==x?e:{...e,ordenes_de_produccion_aceptadas:(null!=(a=e.ordenes_de_produccion_aceptadas)?a:[]).filter(e=>!_[e.id_orden_produccion])}})),g({}),null==u||u()}catch(e){console.error(e),v({title:"Error",body:"Ocurri\xf3 un error al generar la tanda. Reintenta."})}finally{f(!1)}};return(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm text-gray-700 mb-1",children:"Seleccionar l\xednea de producci\xf3n"}),(0,r.jsxs)("select",{value:null!=x?x:"",onChange:e=>{h(Number(e.target.value)),g({})},className:"w-full p-2 border rounded-md bg-white",children:[(0,r.jsx)("option",{value:"",disabled:!0,children:"-- Seleccionar l\xednea --"}),m.map(e=>(0,r.jsxs)("option",{value:e.id_linea_produccion,children:[e.nombre_linea_produccion," — ",e.capacidad_linea_produccion," kg"]},e.id_linea_produccion))]})]}),E?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-white shadow-sm border",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:E.nombre_linea_produccion}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:E.descripcion_linea_produccion})]}),(0,r.jsxs)("div",{className:"text-right text-sm",children:[(0,r.jsxs)("div",{className:"font-semibold",children:[C," kg"]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:"Capacidad"})]})]}),(0,r.jsxs)("div",{className:"mt-2 text-sm",children:[(0,r.jsxs)("div",{children:["Seleccionados: ",Object.values(_).filter(Boolean).length," orden(es)"]}),(0,r.jsxs)("div",{children:["Total kg: ",(0,r.jsxs)("span",{className:"font-semibold",children:[w," kg"]})," — Restante: ",(0,r.jsxs)("span",{className:"".concat(0===k?"text-red-600":"text-gray-700"),children:[k," kg"]})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(null!=(i=E.ordenes_de_produccion_aceptadas)?i:[]).map(e=>{let a=Number(e.cantidad_kg_orden_produccion)||0,n=!_[e.id_orden_produccion]&&w+a>C;return(0,r.jsx)("div",{className:"bg-white rounded-md p-3 shadow-sm border",children:(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:e.nombre_producto}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[e.nombre_cliente," ",e.apellido_cliente]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"font-semibold",children:[a," kg"]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Orden: #",e.id_orden_produccion]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Cantidad Bultos: ",e.cantidad_producto]})]})]}),(0,r.jsxs)("div",{className:"mt-2 text-xs text-gray-500 space-y-1",children:[(0,r.jsxs)("div",{children:["Creada: ",e.fecha_creacion_orden_venta]}),(0,r.jsxs)("div",{children:["Entrega solicitada: ",e.fecha_entrega_solicitada_orden_venta]})]}),e.materias_primas_requeridas&&e.materias_primas_requeridas.length>0&&(0,r.jsxs)("details",{className:"mt-2",children:[(0,r.jsxs)("summary",{className:"text-sm text-primary cursor-pointer",children:["Materias primas (",e.materias_primas_requeridas.length,")"]}),(0,r.jsx)("div",{className:"mt-2 space-y-1 text-sm text-gray-700",children:(e.materias_primas_requeridas||[]).map(e=>{var a;return(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsxs)("div",{children:[e.nombre_materia_prima," - ",e.codigo_lote]}),(0,r.jsxs)("div",{className:"text-xs text-gray-600",children:[e.cantidad_materia_prima," ",e.unidad_medida_materia_prima]})]},null!=(a=e.id_lote_materia_prima)?a:e.codigo_lote)})})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:!!_[e.id_orden_produccion],onChange:()=>((e,a)=>{let n=!!_[e];if(!n&&w+a>C)return void v({title:"Capacidad excedida",body:"No pod\xe9s seleccionar esa orden: superar\xeda la capacidad m\xe1xima de la l\xednea."});g(a=>({...a,[e]:!n}))})(e.id_orden_produccion,a),disabled:n,className:"w-5 h-5","aria-label":"Seleccionar orden ".concat(e.id_orden_produccion)}),n&&(0,r.jsx)("div",{className:"text-xs text-red-600",children:"Excede"})]})]})},e.id_orden_produccion)}),0===(null!=(c=E.ordenes_de_produccion_aceptadas)?c:[]).length&&(0,r.jsx)("div",{className:"text-sm text-gray-500 p-3",children:"No hay \xf3rdenes compatibles disponibles."})]}),(0,r.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>Object.values(_).filter(Boolean).length?w<1?void v({title:"Kg inv\xe1lidos",body:"La cantidad total seleccionada debe ser mayor a 0 kg."}):void N(!0):void v({title:"Selecci\xf3n vac\xeda",body:"Deb\xe9s seleccionar al menos una orden para generar la tanda."}),disabled:y,className:"flex-1 px-4 py-2 bg-amber-600 text-white rounded-md shadow-sm disabled:opacity-60",children:y?"Procesando...":"Generar Tanda"}),(0,r.jsx)("button",{onClick:()=>{g({})},className:"px-4 py-2 bg-gray-100 rounded-md",children:"Limpiar"})]})]}):(0,r.jsx)("div",{className:"text-center text-sm text-gray-500",children:"Seleccion\xe1 una l\xednea para ver \xf3rdenes."}),(0,r.jsxs)(t,{visible:j,onClose:()=>N(!1),title:"Confirmaci\xf3n",children:[(0,r.jsx)("p",{className:"text-sm",children:"ESTA TANDA GENERADA MANUALMENTE PUEDE NO SER LA ELECCI\xd3N M\xc1S \xd3PTIMA PARA LA PLANIFICACI\xd3N, \xbfEST\xc1 SEGURO DE QUERER PONER EN PROCESO ESTA TANDA?"}),(0,r.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,r.jsx)("button",{onClick:S,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md",children:"S\xed, confirmar"}),(0,r.jsx)("button",{onClick:()=>N(!1),className:"px-4 py-2 bg-gray-100 rounded-md",children:"Cancelar"})]})]}),(0,r.jsxs)(t,{visible:!!b,onClose:()=>v(null),title:null!=(o=null==b?void 0:b.title)?o:"",children:[(0,r.jsx)("p",{className:"text-sm",children:null==b?void 0:b.body}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("button",{onClick:()=>v(null),className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Cerrar"})})]})]})}let t=e=>{let{visible:a,onClose:n,title:d,children:s}=e;return a?(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:d}),(0,r.jsx)("div",{children:s}),(0,r.jsx)("button",{onClick:n,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded",children:"Cerrar"})]})}):null};var c=n(51730);let o=()=>(0,r.jsxs)("div",{children:[(0,r.jsx)(c.A,{}),(0,r.jsx)("h1",{className:"text-xxl font-bold text-center my-3",children:"Generar Tanda de Producci\xf3n Manualmente"}),(0,r.jsx)("div",{children:(0,r.jsx)(i,{})})]})},51730:(e,a,n)=>{"use strict";n.d(a,{A:()=>d});var r=n(95155);n(12115);let d=()=>(0,r.jsxs)("header",{className:"bg-gradient-primary text-white py-3 text-center",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold",children:"CORE."}),(0,r.jsx)("h4",{children:"Gestion de Empresas"})]})},96440:(e,a,n)=>{"use strict";n.d(a,{Ec:()=>d,N0:()=>i,sI:()=>t,w_:()=>s});let r="https://eldzogehdj.execute-api.us-east-1.amazonaws.com/prd";async function d(e){let a=await fetch("".concat(r,"/tanda-produccion/post-obtener-tanda-produccion-por-estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({estado:e})});if(!a.ok)throw Error("Error fetching tandas sugeridas");let n=await a.json();return console.log(n),n.lineas_produccion}async function s(e,a){if(console.log("actualizar ot "+e+" a estado: "+a),console.log("actualizar ot "+e+" a estado: "+a),!(await fetch("".concat(r,"/tanda-produccion/post-update-tandas-produccion-estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_tandas:e,estado:a})})).ok)throw Error("Error updating tanda produccion")}async function i(){let e=await fetch("".concat(r,"/tanda-produccion/get-all-ordenes-produccion-aceptadas-por-linea-produccion"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Error generating tanda");let a=await e.json();return console.log(a),a.lineas_produccion}async function t(e){console.log("Crear Tanda Produccion Manual: ",JSON.stringify({id_linea_produccion:e.id_linea_produccion,ordenes_produccion:e.ordenes_produccion}));let a=await fetch("".concat(r,"/tanda-produccion/post-crear-tandas-produccion-manual"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){let e=await a.json();throw console.log("Error creating tanda produccion manual:",e),Error(e.error||"Error creating tanda produccion manual")}return a.json()}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=1829)),_N_E=e.O()}]);