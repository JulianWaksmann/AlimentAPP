Recap: Módulo de Envíos (modelo mínimo desacoplado)

Contexto general
- Objetivo: permitir marcar una orden de venta (OV) para envío, registrar su destino y gestionar la asignación a vehículos con capacidad (kg).
- Diseño: Se agregan tablas direccion, vehiculo y envio. direccion concentra geocodificación para reutilizar direcciones; envio referencia a OV y direccion. Además, se agrega `orden_venta.con_envio` (BOOLEAN) para indicar explícitamente si la OV requiere envío.
- Planificación: la distancia/ETA se calculan en tiempo real con la librería (coordenadas depósito ↔ dirección) y se usan para priorizar/asignar; no se persisten en BD. En `envio` solo se guardan fechas reales (inicio/fin) y estado.

Cambio en orden_venta
- con_envio          → BOOLEAN en `orden_venta` (DEFAULT FALSE). Indica si la OV requiere envío. Al activarlo (TRUE) y cuando la OV esté `lista`, la app debe crear al menos un registro en `envio` asociado.

Tipos (enum)
- envio_estado: pendiente | en_ruta | entregado | cancelado

Tabla: direccion
- id                → Identificador único de la dirección.
- direccion_text    → Texto de dirección ingresado (snapshot legible, ej. “Av. Siempre Viva 742, CABA”).
- lat               → Latitud (WGS84) geocodificada para esa dirección (opcional si no se geocodifica).
- lon               → Longitud (WGS84) geocodificada para esa dirección (opcional si no se geocodifica).

Tabla: vehiculo
- id                → Identificador único del vehículo.
- capacidad_kg      → Capacidad máxima de carga del vehículo en kilogramos.
- disponible        → Flag operativo (TRUE si está disponible para planificar/salir a ruta).

Tabla: envio
- id                   → Identificador único del envío (cada fila representa una entrega/intent asociada a una OV).
- orden_venta_id       → FK a orden_venta.id; OV a entregar (permite múltiples filas para splits de una misma OV).
- id_direccion         → FK a direccion.id; destino de la entrega.
- vehiculo_id          → FK a vehiculo.id; vehículo asignado (NULL mientras está pendiente).
- estado               → Estado operativo del envío (enum envio_estado: pendiente/en_ruta/entregado/cancelado).
- fecha_inicio         → Timestamp real en que el vehículo/entrega salió o fue despachada (se setea al pasar a en_ruta).
- fecha_fin            → Timestamp real en que se completó o canceló la entrega (se setea al cerrar el envío).
- porcentaje_entrega   → Porcentaje de la OV que cubre este envío (100 por defecto; permite splits 60/40, etc.).
- notas                → Observaciones de logística (opcional, ej. “timbre roto”, “franja horaria preferida”).

Operativa sugerida (Lambdas/Endpoints)
- Crear dirección: alta en tabla direccion (opcional geocodificación para lat/lon).
- Marcar OV con envío: setear `orden_venta.con_envio = TRUE` en la creación/edición de la OV.
- Crear envío: cuando la OV esté `lista` y `con_envio = TRUE`, crear registro envio con {orden_venta_id, id_direccion, porcentaje_entrega?} (estado=pendiente).
- Planificar envíos: asigna vehiculo_id en función de capacidad/agenda (sin persistir ruta/ETAs) y deja estado=pendiente hasta despacho.
- Despachar/Entregar/Cancelar: actualiza estado y setea fecha_inicio/fecha_fin reales.

Notas
- Backfill: inicializar `orden_venta.con_envio = FALSE` para registros existentes (mockeadas) para no afectar flujos.
- Ruta/ETA pueden calcularse dinámicamente para visualización, sin persistencia (si se requiere, se puede extender luego sin romper el modelo).
